<!DOCTYPE HTML>
<html lang="zh-TW" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>第14章 ThreadLocal - 高並發編程通用概念（跨 Java/C++/Rust/Go）</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/ascii-diagram.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">高並發編程通用概念（跨 Java/C++/Rust/Go）</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="第14章-threadlocal"><a class="header" href="#第14章-threadlocal">第14章 ThreadLocal</a></h1>
<h2 id="141143-存取機制對應-1411434"><a class="header" href="#141143-存取機制對應-1411434">14.1~14.3 存取機制（對應 14.1~14.3.4）</a></h2>
<!-- subsection-diagram -->
<h3 id="本小節示意圖"><a class="header" href="#本小節示意圖">本小節示意圖</a></h3>
<div class="ascii-svg-wrap">
<svg class="ascii-svg" xmlns="http://www.w3.org/2000/svg" width="718" height="864" viewBox="0 0 718 864" role="img" aria-label="ASCII diagram">
<g fill="currentColor" font-family="Noto Sans Mono CJK TC, Noto Sans Mono CJK SC, Noto Sans Mono CJK JP, Sarasa Mono TC, Cascadia Mono, JetBrains Mono, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, monospace" font-size="16" text-rendering="geometricPrecision" xml:space="preserve">
<text x="34" y="14">T</text>
<text x="44" y="14">h</text>
<text x="54" y="14">r</text>
<text x="64" y="14">e</text>
<text x="74" y="14">a</text>
<text x="84" y="14">d</text>
<text x="94" y="14">L</text>
<text x="104" y="14">o</text>
<text x="114" y="14">c</text>
<text x="124" y="14">a</text>
<text x="134" y="14">l</text>
<text x="154" y="14">存</text>
<text x="174" y="14">取</text>
<text x="194" y="14">機</text>
<text x="214" y="14">制</text>
<text x="234" y="14">：</text>
<text x="254" y="14">T</text>
<text x="264" y="14">h</text>
<text x="274" y="14">r</text>
<text x="284" y="14">e</text>
<text x="294" y="14">a</text>
<text x="304" y="14">d</text>
<text x="324" y="14">內</text>
<text x="344" y="14">部</text>
<text x="364" y="14">結</text>
<text x="384" y="14">構</text>
<text x="404" y="14">圖</text>
<text x="34" y="54">┌</text>
<text x="44" y="54">─</text>
<text x="54" y="54">─</text>
<text x="64" y="54">─</text>
<text x="74" y="54">─</text>
<text x="84" y="54">─</text>
<text x="94" y="54">─</text>
<text x="104" y="54">─</text>
<text x="114" y="54">─</text>
<text x="124" y="54">─</text>
<text x="134" y="54">─</text>
<text x="144" y="54">─</text>
<text x="154" y="54">─</text>
<text x="164" y="54">─</text>
<text x="174" y="54">─</text>
<text x="184" y="54">─</text>
<text x="194" y="54">─</text>
<text x="204" y="54">─</text>
<text x="214" y="54">─</text>
<text x="224" y="54">─</text>
<text x="234" y="54">─</text>
<text x="244" y="54">─</text>
<text x="254" y="54">─</text>
<text x="264" y="54">─</text>
<text x="274" y="54">─</text>
<text x="284" y="54">─</text>
<text x="294" y="54">─</text>
<text x="304" y="54">─</text>
<text x="314" y="54">─</text>
<text x="324" y="54">─</text>
<text x="334" y="54">─</text>
<text x="344" y="54">─</text>
<text x="354" y="54">─</text>
<text x="364" y="54">─</text>
<text x="374" y="54">─</text>
<text x="384" y="54">─</text>
<text x="394" y="54">─</text>
<text x="404" y="54">─</text>
<text x="414" y="54">─</text>
<text x="424" y="54">─</text>
<text x="434" y="54">─</text>
<text x="444" y="54">─</text>
<text x="454" y="54">─</text>
<text x="464" y="54">─</text>
<text x="474" y="54">─</text>
<text x="484" y="54">─</text>
<text x="494" y="54">─</text>
<text x="504" y="54">─</text>
<text x="514" y="54">─</text>
<text x="524" y="54">─</text>
<text x="534" y="54">─</text>
<text x="544" y="54">─</text>
<text x="554" y="54">─</text>
<text x="564" y="54">─</text>
<text x="574" y="54">─</text>
<text x="584" y="54">─</text>
<text x="594" y="54">─</text>
<text x="604" y="54">─</text>
<text x="614" y="54">─</text>
<text x="624" y="54">─</text>
<text x="634" y="54">─</text>
<text x="644" y="54">─</text>
<text x="654" y="54">─</text>
<text x="664" y="54">─</text>
<text x="674" y="54">─</text>
<text x="684" y="54">─</text>
<text x="694" y="54">┐</text>
<text x="34" y="74">│</text>
<text x="64" y="74">T</text>
<text x="74" y="74">h</text>
<text x="84" y="74">r</text>
<text x="94" y="74">e</text>
<text x="104" y="74">a</text>
<text x="114" y="74">d</text>
<text x="134" y="74">A</text>
<text x="694" y="74">│</text>
<text x="34" y="94">│</text>
<text x="64" y="94">┌</text>
<text x="74" y="94">─</text>
<text x="84" y="94">─</text>
<text x="94" y="94">─</text>
<text x="104" y="94">─</text>
<text x="114" y="94">─</text>
<text x="124" y="94">─</text>
<text x="134" y="94">─</text>
<text x="144" y="94">─</text>
<text x="154" y="94">─</text>
<text x="164" y="94">─</text>
<text x="174" y="94">─</text>
<text x="184" y="94">─</text>
<text x="194" y="94">─</text>
<text x="204" y="94">─</text>
<text x="214" y="94">─</text>
<text x="224" y="94">─</text>
<text x="234" y="94">─</text>
<text x="244" y="94">─</text>
<text x="254" y="94">─</text>
<text x="264" y="94">─</text>
<text x="274" y="94">─</text>
<text x="284" y="94">─</text>
<text x="294" y="94">─</text>
<text x="304" y="94">─</text>
<text x="314" y="94">─</text>
<text x="324" y="94">─</text>
<text x="334" y="94">─</text>
<text x="344" y="94">─</text>
<text x="354" y="94">─</text>
<text x="364" y="94">─</text>
<text x="374" y="94">─</text>
<text x="384" y="94">─</text>
<text x="394" y="94">─</text>
<text x="404" y="94">─</text>
<text x="414" y="94">─</text>
<text x="424" y="94">─</text>
<text x="434" y="94">─</text>
<text x="444" y="94">─</text>
<text x="454" y="94">─</text>
<text x="464" y="94">─</text>
<text x="474" y="94">─</text>
<text x="484" y="94">─</text>
<text x="494" y="94">─</text>
<text x="504" y="94">─</text>
<text x="514" y="94">─</text>
<text x="524" y="94">─</text>
<text x="534" y="94">─</text>
<text x="544" y="94">─</text>
<text x="554" y="94">─</text>
<text x="564" y="94">─</text>
<text x="574" y="94">─</text>
<text x="584" y="94">─</text>
<text x="594" y="94">─</text>
<text x="604" y="94">─</text>
<text x="614" y="94">─</text>
<text x="624" y="94">─</text>
<text x="634" y="94">─</text>
<text x="644" y="94">─</text>
<text x="654" y="94">┐</text>
<text x="694" y="94">│</text>
<text x="34" y="114">│</text>
<text x="64" y="114">│</text>
<text x="94" y="114">t</text>
<text x="104" y="114">h</text>
<text x="114" y="114">r</text>
<text x="124" y="114">e</text>
<text x="134" y="114">a</text>
<text x="144" y="114">d</text>
<text x="154" y="114">L</text>
<text x="164" y="114">o</text>
<text x="174" y="114">c</text>
<text x="184" y="114">a</text>
<text x="194" y="114">l</text>
<text x="204" y="114">s</text>
<text x="214" y="114">:</text>
<text x="234" y="114">T</text>
<text x="244" y="114">h</text>
<text x="254" y="114">r</text>
<text x="264" y="114">e</text>
<text x="274" y="114">a</text>
<text x="284" y="114">d</text>
<text x="294" y="114">L</text>
<text x="304" y="114">o</text>
<text x="314" y="114">c</text>
<text x="324" y="114">a</text>
<text x="334" y="114">l</text>
<text x="344" y="114">M</text>
<text x="354" y="114">a</text>
<text x="364" y="114">p</text>
<text x="654" y="114">│</text>
<text x="694" y="114">│</text>
<text x="34" y="134">│</text>
<text x="64" y="134">│</text>
<text x="94" y="134">┌</text>
<text x="104" y="134">─</text>
<text x="114" y="134">─</text>
<text x="124" y="134">─</text>
<text x="134" y="134">─</text>
<text x="144" y="134">─</text>
<text x="154" y="134">─</text>
<text x="164" y="134">─</text>
<text x="174" y="134">─</text>
<text x="184" y="134">─</text>
<text x="194" y="134">─</text>
<text x="204" y="134">─</text>
<text x="214" y="134">─</text>
<text x="224" y="134">─</text>
<text x="234" y="134">─</text>
<text x="244" y="134">─</text>
<text x="254" y="134">─</text>
<text x="264" y="134">─</text>
<text x="274" y="134">─</text>
<text x="284" y="134">─</text>
<text x="294" y="134">─</text>
<text x="304" y="134">─</text>
<text x="314" y="134">─</text>
<text x="324" y="134">─</text>
<text x="334" y="134">─</text>
<text x="344" y="134">─</text>
<text x="354" y="134">─</text>
<text x="364" y="134">─</text>
<text x="374" y="134">─</text>
<text x="384" y="134">─</text>
<text x="394" y="134">─</text>
<text x="404" y="134">─</text>
<text x="414" y="134">─</text>
<text x="424" y="134">─</text>
<text x="434" y="134">─</text>
<text x="444" y="134">─</text>
<text x="454" y="134">─</text>
<text x="464" y="134">─</text>
<text x="474" y="134">─</text>
<text x="484" y="134">─</text>
<text x="494" y="134">─</text>
<text x="504" y="134">─</text>
<text x="514" y="134">─</text>
<text x="524" y="134">─</text>
<text x="534" y="134">─</text>
<text x="544" y="134">─</text>
<text x="554" y="134">─</text>
<text x="564" y="134">─</text>
<text x="574" y="134">─</text>
<text x="584" y="134">─</text>
<text x="594" y="134">─</text>
<text x="604" y="134">─</text>
<text x="614" y="134">─</text>
<text x="624" y="134">┐</text>
<text x="654" y="134">│</text>
<text x="694" y="134">│</text>
<text x="34" y="154">│</text>
<text x="64" y="154">│</text>
<text x="94" y="154">│</text>
<text x="124" y="154">E</text>
<text x="134" y="154">n</text>
<text x="144" y="154">t</text>
<text x="154" y="154">r</text>
<text x="164" y="154">y</text>
<text x="174" y="154">[</text>
<text x="184" y="154">]</text>
<text x="194" y="154">（</text>
<text x="214" y="154">開</text>
<text x="234" y="154">放</text>
<text x="254" y="154">定</text>
<text x="274" y="154">址</text>
<text x="294" y="154">雜</text>
<text x="314" y="154">湊</text>
<text x="334" y="154">表</text>
<text x="354" y="154">）</text>
<text x="624" y="154">│</text>
<text x="654" y="154">│</text>
<text x="694" y="154">│</text>
<text x="34" y="174">│</text>
<text x="64" y="174">│</text>
<text x="94" y="174">│</text>
<text x="124" y="174">┌</text>
<text x="134" y="174">─</text>
<text x="144" y="174">─</text>
<text x="154" y="174">─</text>
<text x="164" y="174">─</text>
<text x="174" y="174">─</text>
<text x="184" y="174">─</text>
<text x="194" y="174">─</text>
<text x="204" y="174">─</text>
<text x="214" y="174">─</text>
<text x="224" y="174">─</text>
<text x="234" y="174">─</text>
<text x="244" y="174">─</text>
<text x="254" y="174">─</text>
<text x="264" y="174">─</text>
<text x="274" y="174">─</text>
<text x="284" y="174">─</text>
<text x="294" y="174">─</text>
<text x="304" y="174">─</text>
<text x="314" y="174">─</text>
<text x="324" y="174">─</text>
<text x="334" y="174">┬</text>
<text x="344" y="174">─</text>
<text x="354" y="174">─</text>
<text x="364" y="174">─</text>
<text x="374" y="174">─</text>
<text x="384" y="174">─</text>
<text x="394" y="174">─</text>
<text x="404" y="174">─</text>
<text x="414" y="174">─</text>
<text x="424" y="174">─</text>
<text x="434" y="174">─</text>
<text x="444" y="174">─</text>
<text x="454" y="174">─</text>
<text x="464" y="174">─</text>
<text x="474" y="174">─</text>
<text x="484" y="174">─</text>
<text x="494" y="174">─</text>
<text x="504" y="174">─</text>
<text x="514" y="174">─</text>
<text x="524" y="174">─</text>
<text x="534" y="174">─</text>
<text x="544" y="174">─</text>
<text x="554" y="174">─</text>
<text x="564" y="174">─</text>
<text x="574" y="174">─</text>
<text x="584" y="174">─</text>
<text x="594" y="174">┐</text>
<text x="624" y="174">│</text>
<text x="654" y="174">│</text>
<text x="694" y="174">│</text>
<text x="34" y="194">│</text>
<text x="64" y="194">│</text>
<text x="94" y="194">│</text>
<text x="124" y="194">│</text>
<text x="144" y="194">k</text>
<text x="154" y="194">e</text>
<text x="164" y="194">y</text>
<text x="184" y="194">=</text>
<text x="204" y="194">W</text>
<text x="214" y="194">e</text>
<text x="224" y="194">a</text>
<text x="234" y="194">k</text>
<text x="244" y="194">R</text>
<text x="254" y="194">e</text>
<text x="264" y="194">f</text>
<text x="274" y="194">(</text>
<text x="284" y="194">T</text>
<text x="294" y="194">L</text>
<text x="304" y="194">1</text>
<text x="314" y="194">)</text>
<text x="334" y="194">│</text>
<text x="354" y="194">v</text>
<text x="364" y="194">a</text>
<text x="374" y="194">l</text>
<text x="384" y="194">u</text>
<text x="394" y="194">e</text>
<text x="414" y="194">=</text>
<text x="434" y="194">&quot;</text>
<text x="444" y="194">u</text>
<text x="454" y="194">s</text>
<text x="464" y="194">e</text>
<text x="474" y="194">r</text>
<text x="484" y="194">_</text>
<text x="494" y="194">4</text>
<text x="504" y="194">2</text>
<text x="514" y="194">&quot;</text>
<text x="594" y="194">│</text>
<text x="624" y="194">│</text>
<text x="654" y="194">│</text>
<text x="694" y="194">│</text>
<text x="34" y="214">│</text>
<text x="64" y="214">│</text>
<text x="94" y="214">│</text>
<text x="124" y="214">├</text>
<text x="134" y="214">─</text>
<text x="144" y="214">─</text>
<text x="154" y="214">─</text>
<text x="164" y="214">─</text>
<text x="174" y="214">─</text>
<text x="184" y="214">─</text>
<text x="194" y="214">─</text>
<text x="204" y="214">─</text>
<text x="214" y="214">─</text>
<text x="224" y="214">─</text>
<text x="234" y="214">─</text>
<text x="244" y="214">─</text>
<text x="254" y="214">─</text>
<text x="264" y="214">─</text>
<text x="274" y="214">─</text>
<text x="284" y="214">─</text>
<text x="294" y="214">─</text>
<text x="304" y="214">─</text>
<text x="314" y="214">─</text>
<text x="324" y="214">─</text>
<text x="334" y="214">┼</text>
<text x="344" y="214">─</text>
<text x="354" y="214">─</text>
<text x="364" y="214">─</text>
<text x="374" y="214">─</text>
<text x="384" y="214">─</text>
<text x="394" y="214">─</text>
<text x="404" y="214">─</text>
<text x="414" y="214">─</text>
<text x="424" y="214">─</text>
<text x="434" y="214">─</text>
<text x="444" y="214">─</text>
<text x="454" y="214">─</text>
<text x="464" y="214">─</text>
<text x="474" y="214">─</text>
<text x="484" y="214">─</text>
<text x="494" y="214">─</text>
<text x="504" y="214">─</text>
<text x="514" y="214">─</text>
<text x="524" y="214">─</text>
<text x="534" y="214">─</text>
<text x="544" y="214">─</text>
<text x="554" y="214">─</text>
<text x="564" y="214">─</text>
<text x="574" y="214">─</text>
<text x="584" y="214">─</text>
<text x="594" y="214">┤</text>
<text x="624" y="214">│</text>
<text x="654" y="214">│</text>
<text x="694" y="214">│</text>
<text x="34" y="234">│</text>
<text x="64" y="234">│</text>
<text x="94" y="234">│</text>
<text x="124" y="234">│</text>
<text x="144" y="234">k</text>
<text x="154" y="234">e</text>
<text x="164" y="234">y</text>
<text x="184" y="234">=</text>
<text x="204" y="234">W</text>
<text x="214" y="234">e</text>
<text x="224" y="234">a</text>
<text x="234" y="234">k</text>
<text x="244" y="234">R</text>
<text x="254" y="234">e</text>
<text x="264" y="234">f</text>
<text x="274" y="234">(</text>
<text x="284" y="234">T</text>
<text x="294" y="234">L</text>
<text x="304" y="234">2</text>
<text x="314" y="234">)</text>
<text x="334" y="234">│</text>
<text x="354" y="234">v</text>
<text x="364" y="234">a</text>
<text x="374" y="234">l</text>
<text x="384" y="234">u</text>
<text x="394" y="234">e</text>
<text x="414" y="234">=</text>
<text x="434" y="234">c</text>
<text x="444" y="234">o</text>
<text x="454" y="234">n</text>
<text x="464" y="234">n</text>
<text x="474" y="234">_</text>
<text x="484" y="234">o</text>
<text x="494" y="234">b</text>
<text x="504" y="234">j</text>
<text x="514" y="234">_</text>
<text x="524" y="234">A</text>
<text x="594" y="234">│</text>
<text x="624" y="234">│</text>
<text x="654" y="234">│</text>
<text x="694" y="234">│</text>
<text x="34" y="254">│</text>
<text x="64" y="254">│</text>
<text x="94" y="254">│</text>
<text x="124" y="254">├</text>
<text x="134" y="254">─</text>
<text x="144" y="254">─</text>
<text x="154" y="254">─</text>
<text x="164" y="254">─</text>
<text x="174" y="254">─</text>
<text x="184" y="254">─</text>
<text x="194" y="254">─</text>
<text x="204" y="254">─</text>
<text x="214" y="254">─</text>
<text x="224" y="254">─</text>
<text x="234" y="254">─</text>
<text x="244" y="254">─</text>
<text x="254" y="254">─</text>
<text x="264" y="254">─</text>
<text x="274" y="254">─</text>
<text x="284" y="254">─</text>
<text x="294" y="254">─</text>
<text x="304" y="254">─</text>
<text x="314" y="254">─</text>
<text x="324" y="254">─</text>
<text x="334" y="254">┼</text>
<text x="344" y="254">─</text>
<text x="354" y="254">─</text>
<text x="364" y="254">─</text>
<text x="374" y="254">─</text>
<text x="384" y="254">─</text>
<text x="394" y="254">─</text>
<text x="404" y="254">─</text>
<text x="414" y="254">─</text>
<text x="424" y="254">─</text>
<text x="434" y="254">─</text>
<text x="444" y="254">─</text>
<text x="454" y="254">─</text>
<text x="464" y="254">─</text>
<text x="474" y="254">─</text>
<text x="484" y="254">─</text>
<text x="494" y="254">─</text>
<text x="504" y="254">─</text>
<text x="514" y="254">─</text>
<text x="524" y="254">─</text>
<text x="534" y="254">─</text>
<text x="544" y="254">─</text>
<text x="554" y="254">─</text>
<text x="564" y="254">─</text>
<text x="574" y="254">─</text>
<text x="584" y="254">─</text>
<text x="594" y="254">┤</text>
<text x="624" y="254">│</text>
<text x="654" y="254">│</text>
<text x="694" y="254">│</text>
<text x="34" y="274">│</text>
<text x="64" y="274">│</text>
<text x="94" y="274">│</text>
<text x="124" y="274">│</text>
<text x="194" y="274">(</text>
<text x="204" y="274">空</text>
<text x="224" y="274">槽</text>
<text x="244" y="274">)</text>
<text x="354" y="274">│</text>
<text x="594" y="274">│</text>
<text x="624" y="274">│</text>
<text x="654" y="274">│</text>
<text x="694" y="274">│</text>
<text x="34" y="294">│</text>
<text x="64" y="294">│</text>
<text x="94" y="294">│</text>
<text x="124" y="294">└</text>
<text x="134" y="294">─</text>
<text x="144" y="294">─</text>
<text x="154" y="294">─</text>
<text x="164" y="294">─</text>
<text x="174" y="294">─</text>
<text x="184" y="294">─</text>
<text x="194" y="294">─</text>
<text x="204" y="294">─</text>
<text x="214" y="294">─</text>
<text x="224" y="294">─</text>
<text x="234" y="294">─</text>
<text x="244" y="294">─</text>
<text x="254" y="294">─</text>
<text x="264" y="294">─</text>
<text x="274" y="294">─</text>
<text x="284" y="294">─</text>
<text x="294" y="294">─</text>
<text x="304" y="294">─</text>
<text x="314" y="294">─</text>
<text x="324" y="294">─</text>
<text x="334" y="294">┴</text>
<text x="344" y="294">─</text>
<text x="354" y="294">─</text>
<text x="364" y="294">─</text>
<text x="374" y="294">─</text>
<text x="384" y="294">─</text>
<text x="394" y="294">─</text>
<text x="404" y="294">─</text>
<text x="414" y="294">─</text>
<text x="424" y="294">─</text>
<text x="434" y="294">─</text>
<text x="444" y="294">─</text>
<text x="454" y="294">─</text>
<text x="464" y="294">─</text>
<text x="474" y="294">─</text>
<text x="484" y="294">─</text>
<text x="494" y="294">─</text>
<text x="504" y="294">─</text>
<text x="514" y="294">─</text>
<text x="524" y="294">─</text>
<text x="534" y="294">─</text>
<text x="544" y="294">─</text>
<text x="554" y="294">─</text>
<text x="564" y="294">─</text>
<text x="574" y="294">─</text>
<text x="584" y="294">─</text>
<text x="594" y="294">┘</text>
<text x="624" y="294">│</text>
<text x="654" y="294">│</text>
<text x="694" y="294">│</text>
<text x="34" y="314">│</text>
<text x="64" y="314">│</text>
<text x="94" y="314">└</text>
<text x="104" y="314">─</text>
<text x="114" y="314">─</text>
<text x="124" y="314">─</text>
<text x="134" y="314">─</text>
<text x="144" y="314">─</text>
<text x="154" y="314">─</text>
<text x="164" y="314">─</text>
<text x="174" y="314">─</text>
<text x="184" y="314">─</text>
<text x="194" y="314">─</text>
<text x="204" y="314">─</text>
<text x="214" y="314">─</text>
<text x="224" y="314">─</text>
<text x="234" y="314">─</text>
<text x="244" y="314">─</text>
<text x="254" y="314">─</text>
<text x="264" y="314">─</text>
<text x="274" y="314">─</text>
<text x="284" y="314">─</text>
<text x="294" y="314">─</text>
<text x="304" y="314">─</text>
<text x="314" y="314">─</text>
<text x="324" y="314">─</text>
<text x="334" y="314">─</text>
<text x="344" y="314">─</text>
<text x="354" y="314">─</text>
<text x="364" y="314">─</text>
<text x="374" y="314">─</text>
<text x="384" y="314">─</text>
<text x="394" y="314">─</text>
<text x="404" y="314">─</text>
<text x="414" y="314">─</text>
<text x="424" y="314">─</text>
<text x="434" y="314">─</text>
<text x="444" y="314">─</text>
<text x="454" y="314">─</text>
<text x="464" y="314">─</text>
<text x="474" y="314">─</text>
<text x="484" y="314">─</text>
<text x="494" y="314">─</text>
<text x="504" y="314">─</text>
<text x="514" y="314">─</text>
<text x="524" y="314">─</text>
<text x="534" y="314">─</text>
<text x="544" y="314">─</text>
<text x="554" y="314">─</text>
<text x="564" y="314">─</text>
<text x="574" y="314">─</text>
<text x="584" y="314">─</text>
<text x="594" y="314">─</text>
<text x="604" y="314">─</text>
<text x="614" y="314">─</text>
<text x="624" y="314">┘</text>
<text x="654" y="314">│</text>
<text x="694" y="314">│</text>
<text x="34" y="334">│</text>
<text x="64" y="334">└</text>
<text x="74" y="334">─</text>
<text x="84" y="334">─</text>
<text x="94" y="334">─</text>
<text x="104" y="334">─</text>
<text x="114" y="334">─</text>
<text x="124" y="334">─</text>
<text x="134" y="334">─</text>
<text x="144" y="334">─</text>
<text x="154" y="334">─</text>
<text x="164" y="334">─</text>
<text x="174" y="334">─</text>
<text x="184" y="334">─</text>
<text x="194" y="334">─</text>
<text x="204" y="334">─</text>
<text x="214" y="334">─</text>
<text x="224" y="334">─</text>
<text x="234" y="334">─</text>
<text x="244" y="334">─</text>
<text x="254" y="334">─</text>
<text x="264" y="334">─</text>
<text x="274" y="334">─</text>
<text x="284" y="334">─</text>
<text x="294" y="334">─</text>
<text x="304" y="334">─</text>
<text x="314" y="334">─</text>
<text x="324" y="334">─</text>
<text x="334" y="334">─</text>
<text x="344" y="334">─</text>
<text x="354" y="334">─</text>
<text x="364" y="334">─</text>
<text x="374" y="334">─</text>
<text x="384" y="334">─</text>
<text x="394" y="334">─</text>
<text x="404" y="334">─</text>
<text x="414" y="334">─</text>
<text x="424" y="334">─</text>
<text x="434" y="334">─</text>
<text x="444" y="334">─</text>
<text x="454" y="334">─</text>
<text x="464" y="334">─</text>
<text x="474" y="334">─</text>
<text x="484" y="334">─</text>
<text x="494" y="334">─</text>
<text x="504" y="334">─</text>
<text x="514" y="334">─</text>
<text x="524" y="334">─</text>
<text x="534" y="334">─</text>
<text x="544" y="334">─</text>
<text x="554" y="334">─</text>
<text x="564" y="334">─</text>
<text x="574" y="334">─</text>
<text x="584" y="334">─</text>
<text x="594" y="334">─</text>
<text x="604" y="334">─</text>
<text x="614" y="334">─</text>
<text x="624" y="334">─</text>
<text x="634" y="334">─</text>
<text x="644" y="334">─</text>
<text x="654" y="334">┘</text>
<text x="694" y="334">│</text>
<text x="34" y="354">└</text>
<text x="44" y="354">─</text>
<text x="54" y="354">─</text>
<text x="64" y="354">─</text>
<text x="74" y="354">─</text>
<text x="84" y="354">─</text>
<text x="94" y="354">─</text>
<text x="104" y="354">─</text>
<text x="114" y="354">─</text>
<text x="124" y="354">─</text>
<text x="134" y="354">─</text>
<text x="144" y="354">─</text>
<text x="154" y="354">─</text>
<text x="164" y="354">─</text>
<text x="174" y="354">─</text>
<text x="184" y="354">─</text>
<text x="194" y="354">─</text>
<text x="204" y="354">─</text>
<text x="214" y="354">─</text>
<text x="224" y="354">─</text>
<text x="234" y="354">─</text>
<text x="244" y="354">─</text>
<text x="254" y="354">─</text>
<text x="264" y="354">─</text>
<text x="274" y="354">─</text>
<text x="284" y="354">─</text>
<text x="294" y="354">─</text>
<text x="304" y="354">─</text>
<text x="314" y="354">─</text>
<text x="324" y="354">─</text>
<text x="334" y="354">─</text>
<text x="344" y="354">─</text>
<text x="354" y="354">─</text>
<text x="364" y="354">─</text>
<text x="374" y="354">─</text>
<text x="384" y="354">─</text>
<text x="394" y="354">─</text>
<text x="404" y="354">─</text>
<text x="414" y="354">─</text>
<text x="424" y="354">─</text>
<text x="434" y="354">─</text>
<text x="444" y="354">─</text>
<text x="454" y="354">─</text>
<text x="464" y="354">─</text>
<text x="474" y="354">─</text>
<text x="484" y="354">─</text>
<text x="494" y="354">─</text>
<text x="504" y="354">─</text>
<text x="514" y="354">─</text>
<text x="524" y="354">─</text>
<text x="534" y="354">─</text>
<text x="544" y="354">─</text>
<text x="554" y="354">─</text>
<text x="564" y="354">─</text>
<text x="574" y="354">─</text>
<text x="584" y="354">─</text>
<text x="594" y="354">─</text>
<text x="604" y="354">─</text>
<text x="614" y="354">─</text>
<text x="624" y="354">─</text>
<text x="634" y="354">─</text>
<text x="644" y="354">─</text>
<text x="654" y="354">─</text>
<text x="664" y="354">─</text>
<text x="674" y="354">─</text>
<text x="684" y="354">─</text>
<text x="694" y="354">┘</text>
<text x="34" y="394">查</text>
<text x="54" y="394">找</text>
<text x="74" y="394">路</text>
<text x="94" y="394">徑</text>
<text x="114" y="394">：</text>
<text x="34" y="414">t</text>
<text x="44" y="414">h</text>
<text x="54" y="414">r</text>
<text x="64" y="414">e</text>
<text x="74" y="414">a</text>
<text x="84" y="414">d</text>
<text x="94" y="414">L</text>
<text x="104" y="414">o</text>
<text x="114" y="414">c</text>
<text x="124" y="414">a</text>
<text x="134" y="414">l</text>
<text x="144" y="414">.</text>
<text x="154" y="414">g</text>
<text x="164" y="414">e</text>
<text x="174" y="414">t</text>
<text x="184" y="414">(</text>
<text x="194" y="414">)</text>
<text x="694" y="434">│</text>
<text x="84" y="454">▼</text>
<text x="34" y="474">T</text>
<text x="44" y="474">h</text>
<text x="54" y="474">r</text>
<text x="64" y="474">e</text>
<text x="74" y="474">a</text>
<text x="84" y="474">d</text>
<text x="94" y="474">.</text>
<text x="104" y="474">c</text>
<text x="114" y="474">u</text>
<text x="124" y="474">r</text>
<text x="134" y="474">r</text>
<text x="144" y="474">e</text>
<text x="154" y="474">n</text>
<text x="164" y="474">t</text>
<text x="174" y="474">T</text>
<text x="184" y="474">h</text>
<text x="194" y="474">r</text>
<text x="204" y="474">e</text>
<text x="214" y="474">a</text>
<text x="224" y="474">d</text>
<text x="234" y="474">(</text>
<text x="244" y="474">)</text>
<text x="354" y="474">←</text>
<text x="374" y="474">取</text>
<text x="394" y="474">得</text>
<text x="414" y="474">當</text>
<text x="434" y="474">前</text>
<text x="454" y="474">執</text>
<text x="474" y="474">行</text>
<text x="494" y="474">緒</text>
<text x="694" y="494">│</text>
<text x="84" y="514">▼</text>
<text x="34" y="534">t</text>
<text x="44" y="534">h</text>
<text x="54" y="534">r</text>
<text x="64" y="534">e</text>
<text x="74" y="534">a</text>
<text x="84" y="534">d</text>
<text x="94" y="534">.</text>
<text x="104" y="534">t</text>
<text x="114" y="534">h</text>
<text x="124" y="534">r</text>
<text x="134" y="534">e</text>
<text x="144" y="534">a</text>
<text x="154" y="534">d</text>
<text x="164" y="534">L</text>
<text x="174" y="534">o</text>
<text x="184" y="534">c</text>
<text x="194" y="534">a</text>
<text x="204" y="534">l</text>
<text x="214" y="534">s</text>
<text x="354" y="534">←</text>
<text x="374" y="534">取</text>
<text x="394" y="534">得</text>
<text x="424" y="534">T</text>
<text x="434" y="534">h</text>
<text x="444" y="534">r</text>
<text x="454" y="534">e</text>
<text x="464" y="534">a</text>
<text x="474" y="534">d</text>
<text x="484" y="534">L</text>
<text x="494" y="534">o</text>
<text x="504" y="534">c</text>
<text x="514" y="534">a</text>
<text x="524" y="534">l</text>
<text x="534" y="534">M</text>
<text x="544" y="534">a</text>
<text x="554" y="534">p</text>
<text x="694" y="554">│</text>
<text x="84" y="574">▼</text>
<text x="34" y="594">m</text>
<text x="44" y="594">a</text>
<text x="54" y="594">p</text>
<text x="64" y="594">.</text>
<text x="74" y="594">g</text>
<text x="84" y="594">e</text>
<text x="94" y="594">t</text>
<text x="104" y="594">(</text>
<text x="114" y="594">t</text>
<text x="124" y="594">h</text>
<text x="134" y="594">i</text>
<text x="144" y="594">s</text>
<text x="154" y="594">)</text>
<text x="354" y="594">←</text>
<text x="374" y="594">t</text>
<text x="384" y="594">h</text>
<text x="394" y="594">i</text>
<text x="404" y="594">s</text>
<text x="424" y="594">=</text>
<text x="444" y="594">T</text>
<text x="454" y="594">h</text>
<text x="464" y="594">r</text>
<text x="474" y="594">e</text>
<text x="484" y="594">a</text>
<text x="494" y="594">d</text>
<text x="504" y="594">L</text>
<text x="514" y="594">o</text>
<text x="524" y="594">c</text>
<text x="534" y="594">a</text>
<text x="544" y="594">l</text>
<text x="564" y="594">實</text>
<text x="584" y="594">例</text>
<text x="604" y="594">，</text>
<text x="624" y="594">作</text>
<text x="644" y="594">為</text>
<text x="674" y="594">k</text>
<text x="684" y="594">e</text>
<text x="694" y="594">y</text>
<text x="694" y="614">│</text>
<text x="84" y="634">▼</text>
<text x="34" y="654">e</text>
<text x="44" y="654">n</text>
<text x="54" y="654">t</text>
<text x="64" y="654">r</text>
<text x="74" y="654">y</text>
<text x="84" y="654">.</text>
<text x="94" y="654">v</text>
<text x="104" y="654">a</text>
<text x="114" y="654">l</text>
<text x="124" y="654">u</text>
<text x="134" y="654">e</text>
<text x="354" y="654">←</text>
<text x="374" y="654">返</text>
<text x="394" y="654">回</text>
<text x="414" y="654">使</text>
<text x="434" y="654">用</text>
<text x="454" y="654">者</text>
<text x="474" y="654">儲</text>
<text x="494" y="654">存</text>
<text x="514" y="654">的</text>
<text x="534" y="654">值</text>
<text x="34" y="694">⚠</text>
<text x="64" y="694">記</text>
<text x="84" y="694">憶</text>
<text x="104" y="694">體</text>
<text x="124" y="694">洩</text>
<text x="144" y="694">漏</text>
<text x="164" y="694">風</text>
<text x="184" y="694">險</text>
<text x="204" y="694">：</text>
<text x="34" y="714">┌</text>
<text x="44" y="714">─</text>
<text x="54" y="714">─</text>
<text x="64" y="714">─</text>
<text x="74" y="714">─</text>
<text x="84" y="714">─</text>
<text x="94" y="714">─</text>
<text x="104" y="714">─</text>
<text x="114" y="714">─</text>
<text x="124" y="714">─</text>
<text x="134" y="714">─</text>
<text x="144" y="714">─</text>
<text x="154" y="714">─</text>
<text x="164" y="714">─</text>
<text x="174" y="714">─</text>
<text x="184" y="714">─</text>
<text x="194" y="714">─</text>
<text x="204" y="714">─</text>
<text x="214" y="714">─</text>
<text x="224" y="714">─</text>
<text x="234" y="714">─</text>
<text x="244" y="714">─</text>
<text x="254" y="714">─</text>
<text x="264" y="714">─</text>
<text x="274" y="714">─</text>
<text x="284" y="714">─</text>
<text x="294" y="714">─</text>
<text x="304" y="714">─</text>
<text x="314" y="714">─</text>
<text x="324" y="714">─</text>
<text x="334" y="714">─</text>
<text x="344" y="714">─</text>
<text x="354" y="714">─</text>
<text x="364" y="714">─</text>
<text x="374" y="714">─</text>
<text x="384" y="714">─</text>
<text x="394" y="714">─</text>
<text x="404" y="714">─</text>
<text x="414" y="714">─</text>
<text x="424" y="714">─</text>
<text x="434" y="714">─</text>
<text x="444" y="714">─</text>
<text x="454" y="714">─</text>
<text x="464" y="714">─</text>
<text x="474" y="714">─</text>
<text x="484" y="714">─</text>
<text x="494" y="714">─</text>
<text x="504" y="714">─</text>
<text x="514" y="714">─</text>
<text x="524" y="714">─</text>
<text x="534" y="714">─</text>
<text x="544" y="714">─</text>
<text x="554" y="714">─</text>
<text x="564" y="714">─</text>
<text x="574" y="714">─</text>
<text x="584" y="714">─</text>
<text x="594" y="714">─</text>
<text x="604" y="714">─</text>
<text x="614" y="714">─</text>
<text x="624" y="714">─</text>
<text x="634" y="714">─</text>
<text x="644" y="714">─</text>
<text x="654" y="714">─</text>
<text x="664" y="714">─</text>
<text x="674" y="714">─</text>
<text x="684" y="714">─</text>
<text x="694" y="714">┐</text>
<text x="34" y="734">│</text>
<text x="64" y="734">T</text>
<text x="74" y="734">h</text>
<text x="84" y="734">r</text>
<text x="94" y="734">e</text>
<text x="104" y="734">a</text>
<text x="114" y="734">d</text>
<text x="124" y="734">L</text>
<text x="134" y="734">o</text>
<text x="144" y="734">c</text>
<text x="154" y="734">a</text>
<text x="164" y="734">l</text>
<text x="184" y="734">實</text>
<text x="204" y="734">例</text>
<text x="224" y="734">被</text>
<text x="254" y="734">G</text>
<text x="264" y="734">C</text>
<text x="274" y="734">（</text>
<text x="294" y="734">k</text>
<text x="304" y="734">e</text>
<text x="314" y="734">y</text>
<text x="334" y="734">變</text>
<text x="364" y="734">n</text>
<text x="374" y="734">u</text>
<text x="384" y="734">l</text>
<text x="394" y="734">l</text>
<text x="404" y="734">）</text>
<text x="694" y="734">│</text>
<text x="34" y="754">│</text>
<text x="64" y="754">→</text>
<text x="84" y="754">E</text>
<text x="94" y="754">n</text>
<text x="104" y="754">t</text>
<text x="114" y="754">r</text>
<text x="124" y="754">y</text>
<text x="144" y="754">的</text>
<text x="174" y="754">k</text>
<text x="184" y="754">e</text>
<text x="194" y="754">y</text>
<text x="214" y="754">=</text>
<text x="234" y="754">n</text>
<text x="244" y="754">u</text>
<text x="254" y="754">l</text>
<text x="264" y="754">l</text>
<text x="274" y="754">，</text>
<text x="294" y="754">但</text>
<text x="324" y="754">v</text>
<text x="334" y="754">a</text>
<text x="344" y="754">l</text>
<text x="354" y="754">u</text>
<text x="364" y="754">e</text>
<text x="384" y="754">仍</text>
<text x="404" y="754">被</text>
<text x="424" y="754">強</text>
<text x="444" y="754">引</text>
<text x="464" y="754">用</text>
<text x="694" y="754">│</text>
<text x="34" y="774">│</text>
<text x="64" y="774">→</text>
<text x="84" y="774">v</text>
<text x="94" y="774">a</text>
<text x="104" y="774">l</text>
<text x="114" y="774">u</text>
<text x="124" y="774">e</text>
<text x="144" y="774">無</text>
<text x="164" y="774">法</text>
<text x="184" y="774">被</text>
<text x="214" y="774">G</text>
<text x="224" y="774">C</text>
<text x="244" y="774">回</text>
<text x="264" y="774">收</text>
<text x="294" y="774">←</text>
<text x="314" y="774">洩</text>
<text x="334" y="774">漏</text>
<text x="354" y="774">！</text>
<text x="694" y="774">│</text>
<text x="34" y="794">│</text>
<text x="694" y="794">│</text>
<text x="34" y="814">│</text>
<text x="64" y="814">防</text>
<text x="84" y="814">範</text>
<text x="104" y="814">：</text>
<text x="124" y="814">使</text>
<text x="144" y="814">用</text>
<text x="164" y="814">完</text>
<text x="184" y="814">畢</text>
<text x="204" y="814">後</text>
<text x="224" y="814">務</text>
<text x="244" y="814">必</text>
<text x="264" y="814">呼</text>
<text x="284" y="814">叫</text>
<text x="314" y="814">t</text>
<text x="324" y="814">h</text>
<text x="334" y="814">r</text>
<text x="344" y="814">e</text>
<text x="354" y="814">a</text>
<text x="364" y="814">d</text>
<text x="374" y="814">L</text>
<text x="384" y="814">o</text>
<text x="394" y="814">c</text>
<text x="404" y="814">a</text>
<text x="414" y="814">l</text>
<text x="424" y="814">.</text>
<text x="434" y="814">r</text>
<text x="444" y="814">e</text>
<text x="454" y="814">m</text>
<text x="464" y="814">o</text>
<text x="474" y="814">v</text>
<text x="484" y="814">e</text>
<text x="494" y="814">(</text>
<text x="504" y="814">)</text>
<text x="694" y="814">│</text>
<text x="34" y="834">└</text>
<text x="44" y="834">─</text>
<text x="54" y="834">─</text>
<text x="64" y="834">─</text>
<text x="74" y="834">─</text>
<text x="84" y="834">─</text>
<text x="94" y="834">─</text>
<text x="104" y="834">─</text>
<text x="114" y="834">─</text>
<text x="124" y="834">─</text>
<text x="134" y="834">─</text>
<text x="144" y="834">─</text>
<text x="154" y="834">─</text>
<text x="164" y="834">─</text>
<text x="174" y="834">─</text>
<text x="184" y="834">─</text>
<text x="194" y="834">─</text>
<text x="204" y="834">─</text>
<text x="214" y="834">─</text>
<text x="224" y="834">─</text>
<text x="234" y="834">─</text>
<text x="244" y="834">─</text>
<text x="254" y="834">─</text>
<text x="264" y="834">─</text>
<text x="274" y="834">─</text>
<text x="284" y="834">─</text>
<text x="294" y="834">─</text>
<text x="304" y="834">─</text>
<text x="314" y="834">─</text>
<text x="324" y="834">─</text>
<text x="334" y="834">─</text>
<text x="344" y="834">─</text>
<text x="354" y="834">─</text>
<text x="364" y="834">─</text>
<text x="374" y="834">─</text>
<text x="384" y="834">─</text>
<text x="394" y="834">─</text>
<text x="404" y="834">─</text>
<text x="414" y="834">─</text>
<text x="424" y="834">─</text>
<text x="434" y="834">─</text>
<text x="444" y="834">─</text>
<text x="454" y="834">─</text>
<text x="464" y="834">─</text>
<text x="474" y="834">─</text>
<text x="484" y="834">─</text>
<text x="494" y="834">─</text>
<text x="504" y="834">─</text>
<text x="514" y="834">─</text>
<text x="524" y="834">─</text>
<text x="534" y="834">─</text>
<text x="544" y="834">─</text>
<text x="554" y="834">─</text>
<text x="564" y="834">─</text>
<text x="574" y="834">─</text>
<text x="584" y="834">─</text>
<text x="594" y="834">─</text>
<text x="604" y="834">─</text>
<text x="614" y="834">─</text>
<text x="624" y="834">─</text>
<text x="634" y="834">─</text>
<text x="644" y="834">─</text>
<text x="654" y="834">─</text>
<text x="664" y="834">─</text>
<text x="674" y="834">─</text>
<text x="684" y="834">─</text>
<text x="694" y="834">┘</text>
</g>
</svg>
</div>
<p>每個執行緒持有自己的本地變數副本，互不干擾。</p>
<p>ThreadLocal 的核心不是「一個全局變數有多份副本」，而是「每個 Thread 物件內部有一個 <code>ThreadLocalMap</code>」。<code>get()/set()</code> 實際上是在當前執行緒的 Map 中查找/寫入，以 ThreadLocal 實例本身作為 key。</p>
<p>關鍵細節：Map 中的 key 是弱引用（WeakReference），若 ThreadLocal 實例沒有外部強引用而被 GC 回收，key 就會變成 null，但 value 仍被 Entry 強引用，造成洩漏。執行緒池中的執行緒長期存活，此問題尤為危險。</p>
<h2 id="144-不繼承性"><a class="header" href="#144-不繼承性">14.4 不繼承性</a></h2>
<!-- subsection-diagram -->
<h3 id="本小節示意圖-1"><a class="header" href="#本小節示意圖-1">本小節示意圖</a></h3>
<div class="ascii-svg-wrap">
<svg class="ascii-svg" xmlns="http://www.w3.org/2000/svg" width="728" height="484" viewBox="0 0 728 484" role="img" aria-label="ASCII diagram">
<g fill="currentColor" font-family="Noto Sans Mono CJK TC, Noto Sans Mono CJK SC, Noto Sans Mono CJK JP, Sarasa Mono TC, Cascadia Mono, JetBrains Mono, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, monospace" font-size="16" text-rendering="geometricPrecision" xml:space="preserve">
<text x="34" y="14">父</text>
<text x="54" y="14">執</text>
<text x="74" y="14">行</text>
<text x="94" y="14">緒</text>
<text x="124" y="14">v</text>
<text x="134" y="14">s</text>
<text x="154" y="14">子</text>
<text x="174" y="14">執</text>
<text x="194" y="14">行</text>
<text x="214" y="14">緒</text>
<text x="234" y="14">的</text>
<text x="264" y="14">T</text>
<text x="274" y="14">h</text>
<text x="284" y="14">r</text>
<text x="294" y="14">e</text>
<text x="304" y="14">a</text>
<text x="314" y="14">d</text>
<text x="324" y="14">L</text>
<text x="334" y="14">o</text>
<text x="344" y="14">c</text>
<text x="354" y="14">a</text>
<text x="364" y="14">l</text>
<text x="384" y="14">隔</text>
<text x="404" y="14">離</text>
<text x="34" y="54">┌</text>
<text x="44" y="54">─</text>
<text x="54" y="54">─</text>
<text x="64" y="54">─</text>
<text x="74" y="54">─</text>
<text x="84" y="54">─</text>
<text x="94" y="54">─</text>
<text x="104" y="54">─</text>
<text x="114" y="54">─</text>
<text x="124" y="54">─</text>
<text x="134" y="54">─</text>
<text x="144" y="54">─</text>
<text x="154" y="54">─</text>
<text x="164" y="54">─</text>
<text x="174" y="54">─</text>
<text x="184" y="54">─</text>
<text x="194" y="54">─</text>
<text x="204" y="54">─</text>
<text x="214" y="54">─</text>
<text x="224" y="54">─</text>
<text x="234" y="54">─</text>
<text x="244" y="54">─</text>
<text x="254" y="54">─</text>
<text x="264" y="54">─</text>
<text x="274" y="54">─</text>
<text x="284" y="54">─</text>
<text x="294" y="54">─</text>
<text x="304" y="54">─</text>
<text x="314" y="54">─</text>
<text x="324" y="54">─</text>
<text x="334" y="54">─</text>
<text x="344" y="54">─</text>
<text x="354" y="54">─</text>
<text x="364" y="54">─</text>
<text x="374" y="54">─</text>
<text x="384" y="54">─</text>
<text x="394" y="54">─</text>
<text x="404" y="54">─</text>
<text x="414" y="54">─</text>
<text x="424" y="54">─</text>
<text x="434" y="54">─</text>
<text x="444" y="54">─</text>
<text x="454" y="54">─</text>
<text x="464" y="54">─</text>
<text x="474" y="54">─</text>
<text x="484" y="54">─</text>
<text x="494" y="54">─</text>
<text x="504" y="54">─</text>
<text x="514" y="54">─</text>
<text x="524" y="54">─</text>
<text x="534" y="54">─</text>
<text x="544" y="54">─</text>
<text x="554" y="54">─</text>
<text x="564" y="54">─</text>
<text x="574" y="54">─</text>
<text x="584" y="54">─</text>
<text x="594" y="54">─</text>
<text x="604" y="54">─</text>
<text x="614" y="54">─</text>
<text x="624" y="54">─</text>
<text x="634" y="54">─</text>
<text x="644" y="54">─</text>
<text x="654" y="54">─</text>
<text x="664" y="54">─</text>
<text x="674" y="54">─</text>
<text x="684" y="54">─</text>
<text x="694" y="54">─</text>
<text x="704" y="54">┐</text>
<text x="34" y="74">│</text>
<text x="64" y="74">父</text>
<text x="84" y="74">執</text>
<text x="104" y="74">行</text>
<text x="124" y="74">緒</text>
<text x="144" y="74">（</text>
<text x="164" y="74">P</text>
<text x="174" y="74">a</text>
<text x="184" y="74">r</text>
<text x="194" y="74">e</text>
<text x="204" y="74">n</text>
<text x="214" y="74">t</text>
<text x="234" y="74">T</text>
<text x="244" y="74">h</text>
<text x="254" y="74">r</text>
<text x="264" y="74">e</text>
<text x="274" y="74">a</text>
<text x="284" y="74">d</text>
<text x="294" y="74">）</text>
<text x="704" y="74">│</text>
<text x="34" y="94">│</text>
<text x="64" y="94">t</text>
<text x="74" y="94">h</text>
<text x="84" y="94">r</text>
<text x="94" y="94">e</text>
<text x="104" y="94">a</text>
<text x="114" y="94">d</text>
<text x="124" y="94">L</text>
<text x="134" y="94">o</text>
<text x="144" y="94">c</text>
<text x="154" y="94">a</text>
<text x="164" y="94">l</text>
<text x="174" y="94">s</text>
<text x="184" y="94">:</text>
<text x="204" y="94">{</text>
<text x="224" y="94">T</text>
<text x="234" y="94">L</text>
<text x="244" y="94">_</text>
<text x="254" y="94">u</text>
<text x="264" y="94">s</text>
<text x="274" y="94">e</text>
<text x="284" y="94">r</text>
<text x="294" y="94">_</text>
<text x="304" y="94">i</text>
<text x="314" y="94">d</text>
<text x="334" y="94">→</text>
<text x="354" y="94">4</text>
<text x="364" y="94">2</text>
<text x="374" y="94">,</text>
<text x="394" y="94">T</text>
<text x="404" y="94">L</text>
<text x="414" y="94">_</text>
<text x="424" y="94">r</text>
<text x="434" y="94">e</text>
<text x="444" y="94">q</text>
<text x="454" y="94">u</text>
<text x="464" y="94">e</text>
<text x="474" y="94">s</text>
<text x="484" y="94">t</text>
<text x="504" y="94">→</text>
<text x="524" y="94">&quot;</text>
<text x="534" y="94">r</text>
<text x="544" y="94">e</text>
<text x="554" y="94">q</text>
<text x="564" y="94">-</text>
<text x="574" y="94">0</text>
<text x="584" y="94">0</text>
<text x="594" y="94">1</text>
<text x="604" y="94">&quot;</text>
<text x="624" y="94">}</text>
<text x="704" y="94">│</text>
<text x="34" y="114">└</text>
<text x="44" y="114">─</text>
<text x="54" y="114">─</text>
<text x="64" y="114">─</text>
<text x="74" y="114">─</text>
<text x="84" y="114">─</text>
<text x="94" y="114">─</text>
<text x="104" y="114">─</text>
<text x="114" y="114">─</text>
<text x="124" y="114">─</text>
<text x="134" y="114">─</text>
<text x="144" y="114">─</text>
<text x="154" y="114">─</text>
<text x="164" y="114">─</text>
<text x="174" y="114">─</text>
<text x="184" y="114">─</text>
<text x="194" y="114">─</text>
<text x="204" y="114">─</text>
<text x="214" y="114">─</text>
<text x="224" y="114">─</text>
<text x="234" y="114">─</text>
<text x="244" y="114">─</text>
<text x="254" y="114">─</text>
<text x="264" y="114">─</text>
<text x="274" y="114">─</text>
<text x="284" y="114">─</text>
<text x="294" y="114">─</text>
<text x="304" y="114">─</text>
<text x="314" y="114">─</text>
<text x="324" y="114">┬</text>
<text x="334" y="114">─</text>
<text x="344" y="114">─</text>
<text x="354" y="114">─</text>
<text x="364" y="114">─</text>
<text x="374" y="114">─</text>
<text x="384" y="114">─</text>
<text x="394" y="114">─</text>
<text x="404" y="114">─</text>
<text x="414" y="114">─</text>
<text x="424" y="114">─</text>
<text x="434" y="114">─</text>
<text x="444" y="114">─</text>
<text x="454" y="114">─</text>
<text x="464" y="114">─</text>
<text x="474" y="114">─</text>
<text x="484" y="114">─</text>
<text x="494" y="114">─</text>
<text x="504" y="114">─</text>
<text x="514" y="114">─</text>
<text x="524" y="114">─</text>
<text x="534" y="114">─</text>
<text x="544" y="114">─</text>
<text x="554" y="114">─</text>
<text x="564" y="114">─</text>
<text x="574" y="114">─</text>
<text x="584" y="114">─</text>
<text x="594" y="114">─</text>
<text x="604" y="114">─</text>
<text x="614" y="114">─</text>
<text x="624" y="114">─</text>
<text x="634" y="114">─</text>
<text x="644" y="114">─</text>
<text x="654" y="114">─</text>
<text x="664" y="114">─</text>
<text x="674" y="114">─</text>
<text x="684" y="114">─</text>
<text x="694" y="114">─</text>
<text x="704" y="114">┘</text>
<text x="324" y="134">│</text>
<text x="344" y="134">n</text>
<text x="354" y="134">e</text>
<text x="364" y="134">w</text>
<text x="384" y="134">T</text>
<text x="394" y="134">h</text>
<text x="404" y="134">r</text>
<text x="414" y="134">e</text>
<text x="424" y="134">a</text>
<text x="434" y="134">d</text>
<text x="444" y="134">(</text>
<text x="454" y="134">.</text>
<text x="464" y="134">.</text>
<text x="474" y="134">.</text>
<text x="484" y="134">)</text>
<text x="514" y="134">或</text>
<text x="554" y="134">p</text>
<text x="564" y="134">o</text>
<text x="574" y="134">o</text>
<text x="584" y="134">l</text>
<text x="594" y="134">.</text>
<text x="604" y="134">s</text>
<text x="614" y="134">u</text>
<text x="624" y="134">b</text>
<text x="634" y="134">m</text>
<text x="644" y="134">i</text>
<text x="654" y="134">t</text>
<text x="664" y="134">(</text>
<text x="674" y="134">.</text>
<text x="684" y="134">.</text>
<text x="694" y="134">.</text>
<text x="704" y="134">)</text>
<text x="324" y="154">│</text>
<text x="344" y="154">建</text>
<text x="364" y="154">立</text>
<text x="384" y="154">子</text>
<text x="404" y="154">執</text>
<text x="424" y="154">行</text>
<text x="444" y="154">緒</text>
<text x="324" y="174">▼</text>
<text x="34" y="194">┌</text>
<text x="44" y="194">─</text>
<text x="54" y="194">─</text>
<text x="64" y="194">─</text>
<text x="74" y="194">─</text>
<text x="84" y="194">─</text>
<text x="94" y="194">─</text>
<text x="104" y="194">─</text>
<text x="114" y="194">─</text>
<text x="124" y="194">─</text>
<text x="134" y="194">─</text>
<text x="144" y="194">─</text>
<text x="154" y="194">─</text>
<text x="164" y="194">─</text>
<text x="174" y="194">─</text>
<text x="184" y="194">─</text>
<text x="194" y="194">─</text>
<text x="204" y="194">─</text>
<text x="214" y="194">─</text>
<text x="224" y="194">─</text>
<text x="234" y="194">─</text>
<text x="244" y="194">─</text>
<text x="254" y="194">─</text>
<text x="264" y="194">─</text>
<text x="274" y="194">─</text>
<text x="284" y="194">─</text>
<text x="294" y="194">─</text>
<text x="304" y="194">─</text>
<text x="314" y="194">─</text>
<text x="324" y="194">─</text>
<text x="334" y="194">─</text>
<text x="344" y="194">─</text>
<text x="354" y="194">─</text>
<text x="364" y="194">─</text>
<text x="374" y="194">─</text>
<text x="384" y="194">─</text>
<text x="394" y="194">─</text>
<text x="404" y="194">─</text>
<text x="414" y="194">─</text>
<text x="424" y="194">─</text>
<text x="434" y="194">─</text>
<text x="444" y="194">─</text>
<text x="454" y="194">─</text>
<text x="464" y="194">─</text>
<text x="474" y="194">─</text>
<text x="484" y="194">─</text>
<text x="494" y="194">─</text>
<text x="504" y="194">─</text>
<text x="514" y="194">─</text>
<text x="524" y="194">─</text>
<text x="534" y="194">─</text>
<text x="544" y="194">─</text>
<text x="554" y="194">─</text>
<text x="564" y="194">─</text>
<text x="574" y="194">─</text>
<text x="584" y="194">─</text>
<text x="594" y="194">─</text>
<text x="604" y="194">─</text>
<text x="614" y="194">─</text>
<text x="624" y="194">─</text>
<text x="634" y="194">─</text>
<text x="644" y="194">─</text>
<text x="654" y="194">─</text>
<text x="664" y="194">─</text>
<text x="674" y="194">─</text>
<text x="684" y="194">─</text>
<text x="694" y="194">─</text>
<text x="704" y="194">┐</text>
<text x="34" y="214">│</text>
<text x="64" y="214">子</text>
<text x="84" y="214">執</text>
<text x="104" y="214">行</text>
<text x="124" y="214">緒</text>
<text x="144" y="214">（</text>
<text x="164" y="214">C</text>
<text x="174" y="214">h</text>
<text x="184" y="214">i</text>
<text x="194" y="214">l</text>
<text x="204" y="214">d</text>
<text x="224" y="214">T</text>
<text x="234" y="214">h</text>
<text x="244" y="214">r</text>
<text x="254" y="214">e</text>
<text x="264" y="214">a</text>
<text x="274" y="214">d</text>
<text x="284" y="214">）</text>
<text x="704" y="214">│</text>
<text x="34" y="234">│</text>
<text x="64" y="234">t</text>
<text x="74" y="234">h</text>
<text x="84" y="234">r</text>
<text x="94" y="234">e</text>
<text x="104" y="234">a</text>
<text x="114" y="234">d</text>
<text x="124" y="234">L</text>
<text x="134" y="234">o</text>
<text x="144" y="234">c</text>
<text x="154" y="234">a</text>
<text x="164" y="234">l</text>
<text x="174" y="234">s</text>
<text x="184" y="234">:</text>
<text x="204" y="234">{</text>
<text x="224" y="234">}</text>
<text x="264" y="234">←</text>
<text x="284" y="234">空</text>
<text x="314" y="234">M</text>
<text x="324" y="234">a</text>
<text x="334" y="234">p</text>
<text x="344" y="234">！</text>
<text x="704" y="234">│</text>
<text x="44" y="254">│</text>
<text x="704" y="254">│</text>
<text x="34" y="274">│</text>
<text x="64" y="274">c</text>
<text x="74" y="274">h</text>
<text x="84" y="274">i</text>
<text x="94" y="274">l</text>
<text x="104" y="274">d</text>
<text x="114" y="274">.</text>
<text x="124" y="274">g</text>
<text x="134" y="274">e</text>
<text x="144" y="274">t</text>
<text x="154" y="274">(</text>
<text x="164" y="274">T</text>
<text x="174" y="274">L</text>
<text x="184" y="274">_</text>
<text x="194" y="274">u</text>
<text x="204" y="274">s</text>
<text x="214" y="274">e</text>
<text x="224" y="274">r</text>
<text x="234" y="274">_</text>
<text x="244" y="274">i</text>
<text x="254" y="274">d</text>
<text x="264" y="274">)</text>
<text x="294" y="274">→</text>
<text x="314" y="274">n</text>
<text x="324" y="274">u</text>
<text x="334" y="274">l</text>
<text x="344" y="274">l</text>
<text x="354" y="274">（</text>
<text x="374" y="274">或</text>
<text x="404" y="274">i</text>
<text x="414" y="274">n</text>
<text x="424" y="274">i</text>
<text x="434" y="274">t</text>
<text x="444" y="274">i</text>
<text x="454" y="274">a</text>
<text x="464" y="274">l</text>
<text x="474" y="274">V</text>
<text x="484" y="274">a</text>
<text x="494" y="274">l</text>
<text x="504" y="274">u</text>
<text x="514" y="274">e</text>
<text x="524" y="274">(</text>
<text x="534" y="274">)</text>
<text x="544" y="274">）</text>
<text x="704" y="274">│</text>
<text x="34" y="294">│</text>
<text x="64" y="294">c</text>
<text x="74" y="294">h</text>
<text x="84" y="294">i</text>
<text x="94" y="294">l</text>
<text x="104" y="294">d</text>
<text x="114" y="294">.</text>
<text x="124" y="294">g</text>
<text x="134" y="294">e</text>
<text x="144" y="294">t</text>
<text x="154" y="294">(</text>
<text x="164" y="294">T</text>
<text x="174" y="294">L</text>
<text x="184" y="294">_</text>
<text x="194" y="294">r</text>
<text x="204" y="294">e</text>
<text x="214" y="294">q</text>
<text x="224" y="294">u</text>
<text x="234" y="294">e</text>
<text x="244" y="294">s</text>
<text x="254" y="294">t</text>
<text x="264" y="294">)</text>
<text x="294" y="294">→</text>
<text x="314" y="294">n</text>
<text x="324" y="294">u</text>
<text x="334" y="294">l</text>
<text x="344" y="294">l</text>
<text x="354" y="294">（</text>
<text x="374" y="294">或</text>
<text x="404" y="294">i</text>
<text x="414" y="294">n</text>
<text x="424" y="294">i</text>
<text x="434" y="294">t</text>
<text x="444" y="294">i</text>
<text x="454" y="294">a</text>
<text x="464" y="294">l</text>
<text x="474" y="294">V</text>
<text x="484" y="294">a</text>
<text x="494" y="294">l</text>
<text x="504" y="294">u</text>
<text x="514" y="294">e</text>
<text x="524" y="294">(</text>
<text x="534" y="294">)</text>
<text x="544" y="294">）</text>
<text x="704" y="294">│</text>
<text x="34" y="314">└</text>
<text x="44" y="314">─</text>
<text x="54" y="314">─</text>
<text x="64" y="314">─</text>
<text x="74" y="314">─</text>
<text x="84" y="314">─</text>
<text x="94" y="314">─</text>
<text x="104" y="314">─</text>
<text x="114" y="314">─</text>
<text x="124" y="314">─</text>
<text x="134" y="314">─</text>
<text x="144" y="314">─</text>
<text x="154" y="314">─</text>
<text x="164" y="314">─</text>
<text x="174" y="314">─</text>
<text x="184" y="314">─</text>
<text x="194" y="314">─</text>
<text x="204" y="314">─</text>
<text x="214" y="314">─</text>
<text x="224" y="314">─</text>
<text x="234" y="314">─</text>
<text x="244" y="314">─</text>
<text x="254" y="314">─</text>
<text x="264" y="314">─</text>
<text x="274" y="314">─</text>
<text x="284" y="314">─</text>
<text x="294" y="314">─</text>
<text x="304" y="314">─</text>
<text x="314" y="314">─</text>
<text x="324" y="314">─</text>
<text x="334" y="314">─</text>
<text x="344" y="314">─</text>
<text x="354" y="314">─</text>
<text x="364" y="314">─</text>
<text x="374" y="314">─</text>
<text x="384" y="314">─</text>
<text x="394" y="314">─</text>
<text x="404" y="314">─</text>
<text x="414" y="314">─</text>
<text x="424" y="314">─</text>
<text x="434" y="314">─</text>
<text x="444" y="314">─</text>
<text x="454" y="314">─</text>
<text x="464" y="314">─</text>
<text x="474" y="314">─</text>
<text x="484" y="314">─</text>
<text x="494" y="314">─</text>
<text x="504" y="314">─</text>
<text x="514" y="314">─</text>
<text x="524" y="314">─</text>
<text x="534" y="314">─</text>
<text x="544" y="314">─</text>
<text x="554" y="314">─</text>
<text x="564" y="314">─</text>
<text x="574" y="314">─</text>
<text x="584" y="314">─</text>
<text x="594" y="314">─</text>
<text x="604" y="314">─</text>
<text x="614" y="314">─</text>
<text x="624" y="314">─</text>
<text x="634" y="314">─</text>
<text x="644" y="314">─</text>
<text x="654" y="314">─</text>
<text x="664" y="314">─</text>
<text x="674" y="314">─</text>
<text x="684" y="314">─</text>
<text x="694" y="314">─</text>
<text x="704" y="314">┘</text>
<text x="34" y="354">⚠</text>
<text x="64" y="354">常</text>
<text x="84" y="354">見</text>
<text x="104" y="354">問</text>
<text x="124" y="354">題</text>
<text x="144" y="354">：</text>
<text x="34" y="374">父</text>
<text x="54" y="374">執</text>
<text x="74" y="374">行</text>
<text x="94" y="374">緒</text>
<text x="114" y="374">設</text>
<text x="134" y="374">定</text>
<text x="154" y="374">了</text>
<text x="184" y="374">u</text>
<text x="194" y="374">s</text>
<text x="204" y="374">e</text>
<text x="214" y="374">r</text>
<text x="224" y="374">_</text>
<text x="234" y="374">i</text>
<text x="244" y="374">d</text>
<text x="254" y="374">=</text>
<text x="264" y="374">4</text>
<text x="274" y="374">2</text>
<text x="284" y="374">（</text>
<text x="304" y="374">用</text>
<text x="324" y="374">於</text>
<text x="344" y="374">追</text>
<text x="364" y="374">蹤</text>
<text x="384" y="374">請</text>
<text x="404" y="374">求</text>
<text x="424" y="374">）</text>
<text x="34" y="394">提</text>
<text x="54" y="394">交</text>
<text x="74" y="394">任</text>
<text x="94" y="394">務</text>
<text x="114" y="394">到</text>
<text x="134" y="394">執</text>
<text x="154" y="394">行</text>
<text x="174" y="394">緒</text>
<text x="194" y="394">池</text>
<text x="214" y="394">後</text>
<text x="234" y="394">，</text>
<text x="254" y="394">子</text>
<text x="274" y="394">執</text>
<text x="294" y="394">行</text>
<text x="314" y="394">緒</text>
<text x="334" y="394">讀</text>
<text x="354" y="394">到</text>
<text x="384" y="394">n</text>
<text x="394" y="394">u</text>
<text x="404" y="394">l</text>
<text x="414" y="394">l</text>
<text x="34" y="414">→</text>
<text x="54" y="414">日</text>
<text x="74" y="414">誌</text>
<text x="94" y="414">無</text>
<text x="114" y="414">法</text>
<text x="134" y="414">關</text>
<text x="154" y="414">聯</text>
<text x="174" y="414">到</text>
<text x="194" y="414">正</text>
<text x="214" y="414">確</text>
<text x="234" y="414">的</text>
<text x="254" y="414">請</text>
<text x="274" y="414">求</text>
<text x="304" y="414">I</text>
<text x="314" y="414">D</text>
<text x="34" y="434">→</text>
<text x="54" y="434">解</text>
<text x="74" y="434">決</text>
<text x="94" y="434">方</text>
<text x="114" y="434">案</text>
<text x="134" y="434">：</text>
<text x="154" y="434">改</text>
<text x="174" y="434">用</text>
<text x="204" y="434">I</text>
<text x="214" y="434">n</text>
<text x="224" y="434">h</text>
<text x="234" y="434">e</text>
<text x="244" y="434">r</text>
<text x="254" y="434">i</text>
<text x="264" y="434">t</text>
<text x="274" y="434">a</text>
<text x="284" y="434">b</text>
<text x="294" y="434">l</text>
<text x="304" y="434">e</text>
<text x="314" y="434">T</text>
<text x="324" y="434">h</text>
<text x="334" y="434">r</text>
<text x="344" y="434">e</text>
<text x="354" y="434">a</text>
<text x="364" y="434">d</text>
<text x="374" y="434">L</text>
<text x="384" y="434">o</text>
<text x="394" y="434">c</text>
<text x="404" y="434">a</text>
<text x="414" y="434">l</text>
<text x="424" y="434">（</text>
<text x="444" y="434">見</text>
<text x="474" y="434">1</text>
<text x="484" y="434">4</text>
<text x="494" y="434">.</text>
<text x="504" y="434">5</text>
<text x="514" y="434">）</text>
<text x="154" y="454">或</text>
<text x="174" y="454">手</text>
<text x="194" y="454">動</text>
<text x="214" y="454">在</text>
<text x="244" y="454">s</text>
<text x="254" y="454">u</text>
<text x="264" y="454">b</text>
<text x="274" y="454">m</text>
<text x="284" y="454">i</text>
<text x="294" y="454">t</text>
<text x="314" y="454">時</text>
<text x="334" y="454">捕</text>
<text x="354" y="454">獲</text>
<text x="374" y="454">並</text>
<text x="394" y="454">傳</text>
<text x="414" y="454">遞</text>
<text x="434" y="454">值</text>
</g>
</svg>
</div>
<p>子執行緒預設看不到父執行緒 ThreadLocal。</p>
<p>這個設計是有意的：ThreadLocal 的語義是「執行緒私有」，若自動繼承反而破壞隔離性。但在請求追蹤（Trace ID）等場景確實需要傳遞上下文，此時應使用 InheritableThreadLocal 或顯式傳遞。</p>
<h2 id="145146-可繼承變體"><a class="header" href="#145146-可繼承變體">14.5~14.6 可繼承變體</a></h2>
<!-- subsection-diagram -->
<h3 id="本小節示意圖-2"><a class="header" href="#本小節示意圖-2">本小節示意圖</a></h3>
<div class="ascii-svg-wrap">
<svg class="ascii-svg" xmlns="http://www.w3.org/2000/svg" width="728" height="824" viewBox="0 0 728 824" role="img" aria-label="ASCII diagram">
<g fill="currentColor" font-family="Noto Sans Mono CJK TC, Noto Sans Mono CJK SC, Noto Sans Mono CJK JP, Sarasa Mono TC, Cascadia Mono, JetBrains Mono, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, monospace" font-size="16" text-rendering="geometricPrecision" xml:space="preserve">
<text x="34" y="14">I</text>
<text x="44" y="14">n</text>
<text x="54" y="14">h</text>
<text x="64" y="14">e</text>
<text x="74" y="14">r</text>
<text x="84" y="14">i</text>
<text x="94" y="14">t</text>
<text x="104" y="14">a</text>
<text x="114" y="14">b</text>
<text x="124" y="14">l</text>
<text x="134" y="14">e</text>
<text x="144" y="14">T</text>
<text x="154" y="14">h</text>
<text x="164" y="14">r</text>
<text x="174" y="14">e</text>
<text x="184" y="14">a</text>
<text x="194" y="14">d</text>
<text x="204" y="14">L</text>
<text x="214" y="14">o</text>
<text x="224" y="14">c</text>
<text x="234" y="14">a</text>
<text x="244" y="14">l</text>
<text x="254" y="14">：</text>
<text x="274" y="14">建</text>
<text x="294" y="14">立</text>
<text x="314" y="14">子</text>
<text x="334" y="14">執</text>
<text x="354" y="14">行</text>
<text x="374" y="14">緒</text>
<text x="394" y="14">時</text>
<text x="414" y="14">複</text>
<text x="434" y="14">製</text>
<text x="454" y="14">快</text>
<text x="474" y="14">照</text>
<text x="34" y="54">┌</text>
<text x="44" y="54">─</text>
<text x="54" y="54">─</text>
<text x="64" y="54">─</text>
<text x="74" y="54">─</text>
<text x="84" y="54">─</text>
<text x="94" y="54">─</text>
<text x="104" y="54">─</text>
<text x="114" y="54">─</text>
<text x="124" y="54">─</text>
<text x="134" y="54">─</text>
<text x="144" y="54">─</text>
<text x="154" y="54">─</text>
<text x="164" y="54">─</text>
<text x="174" y="54">─</text>
<text x="184" y="54">─</text>
<text x="194" y="54">─</text>
<text x="204" y="54">─</text>
<text x="214" y="54">─</text>
<text x="224" y="54">─</text>
<text x="234" y="54">─</text>
<text x="244" y="54">─</text>
<text x="254" y="54">─</text>
<text x="264" y="54">─</text>
<text x="274" y="54">─</text>
<text x="284" y="54">─</text>
<text x="294" y="54">─</text>
<text x="304" y="54">─</text>
<text x="314" y="54">─</text>
<text x="324" y="54">─</text>
<text x="334" y="54">─</text>
<text x="344" y="54">─</text>
<text x="354" y="54">─</text>
<text x="364" y="54">─</text>
<text x="374" y="54">─</text>
<text x="384" y="54">─</text>
<text x="394" y="54">─</text>
<text x="404" y="54">─</text>
<text x="414" y="54">─</text>
<text x="424" y="54">─</text>
<text x="434" y="54">─</text>
<text x="444" y="54">─</text>
<text x="454" y="54">─</text>
<text x="464" y="54">─</text>
<text x="474" y="54">─</text>
<text x="484" y="54">─</text>
<text x="494" y="54">─</text>
<text x="504" y="54">─</text>
<text x="514" y="54">─</text>
<text x="524" y="54">─</text>
<text x="534" y="54">─</text>
<text x="544" y="54">─</text>
<text x="554" y="54">─</text>
<text x="564" y="54">─</text>
<text x="574" y="54">─</text>
<text x="584" y="54">─</text>
<text x="594" y="54">─</text>
<text x="604" y="54">─</text>
<text x="614" y="54">─</text>
<text x="624" y="54">─</text>
<text x="634" y="54">─</text>
<text x="644" y="54">─</text>
<text x="654" y="54">─</text>
<text x="664" y="54">─</text>
<text x="674" y="54">─</text>
<text x="684" y="54">─</text>
<text x="694" y="54">─</text>
<text x="704" y="54">┐</text>
<text x="34" y="74">│</text>
<text x="64" y="74">父</text>
<text x="84" y="74">執</text>
<text x="104" y="74">行</text>
<text x="124" y="74">緒</text>
<text x="704" y="74">│</text>
<text x="34" y="94">│</text>
<text x="64" y="94">i</text>
<text x="74" y="94">n</text>
<text x="84" y="94">h</text>
<text x="94" y="94">e</text>
<text x="104" y="94">r</text>
<text x="114" y="94">i</text>
<text x="124" y="94">t</text>
<text x="134" y="94">a</text>
<text x="144" y="94">b</text>
<text x="154" y="94">l</text>
<text x="164" y="94">e</text>
<text x="174" y="94">T</text>
<text x="184" y="94">h</text>
<text x="194" y="94">r</text>
<text x="204" y="94">e</text>
<text x="214" y="94">a</text>
<text x="224" y="94">d</text>
<text x="234" y="94">L</text>
<text x="244" y="94">o</text>
<text x="254" y="94">c</text>
<text x="264" y="94">a</text>
<text x="274" y="94">l</text>
<text x="284" y="94">s</text>
<text x="294" y="94">:</text>
<text x="314" y="94">{</text>
<text x="334" y="94">I</text>
<text x="344" y="94">T</text>
<text x="354" y="94">L</text>
<text x="364" y="94">_</text>
<text x="374" y="94">u</text>
<text x="384" y="94">s</text>
<text x="394" y="94">e</text>
<text x="404" y="94">r</text>
<text x="424" y="94">→</text>
<text x="444" y="94">4</text>
<text x="454" y="94">2</text>
<text x="464" y="94">,</text>
<text x="484" y="94">I</text>
<text x="494" y="94">T</text>
<text x="504" y="94">L</text>
<text x="514" y="94">_</text>
<text x="524" y="94">l</text>
<text x="534" y="94">o</text>
<text x="544" y="94">c</text>
<text x="554" y="94">a</text>
<text x="564" y="94">l</text>
<text x="574" y="94">e</text>
<text x="594" y="94">→</text>
<text x="614" y="94">&quot;</text>
<text x="624" y="94">z</text>
<text x="634" y="94">h</text>
<text x="644" y="94">&quot;</text>
<text x="664" y="94">}</text>
<text x="704" y="94">│</text>
<text x="34" y="114">└</text>
<text x="44" y="114">─</text>
<text x="54" y="114">─</text>
<text x="64" y="114">─</text>
<text x="74" y="114">─</text>
<text x="84" y="114">─</text>
<text x="94" y="114">─</text>
<text x="104" y="114">─</text>
<text x="114" y="114">─</text>
<text x="124" y="114">─</text>
<text x="134" y="114">─</text>
<text x="144" y="114">─</text>
<text x="154" y="114">─</text>
<text x="164" y="114">─</text>
<text x="174" y="114">─</text>
<text x="184" y="114">─</text>
<text x="194" y="114">─</text>
<text x="204" y="114">─</text>
<text x="214" y="114">─</text>
<text x="224" y="114">─</text>
<text x="234" y="114">─</text>
<text x="244" y="114">─</text>
<text x="254" y="114">─</text>
<text x="264" y="114">─</text>
<text x="274" y="114">─</text>
<text x="284" y="114">─</text>
<text x="294" y="114">─</text>
<text x="304" y="114">─</text>
<text x="314" y="114">─</text>
<text x="324" y="114">┬</text>
<text x="334" y="114">─</text>
<text x="344" y="114">─</text>
<text x="354" y="114">─</text>
<text x="364" y="114">─</text>
<text x="374" y="114">─</text>
<text x="384" y="114">─</text>
<text x="394" y="114">─</text>
<text x="404" y="114">─</text>
<text x="414" y="114">─</text>
<text x="424" y="114">─</text>
<text x="434" y="114">─</text>
<text x="444" y="114">─</text>
<text x="454" y="114">─</text>
<text x="464" y="114">─</text>
<text x="474" y="114">─</text>
<text x="484" y="114">─</text>
<text x="494" y="114">─</text>
<text x="504" y="114">─</text>
<text x="514" y="114">─</text>
<text x="524" y="114">─</text>
<text x="534" y="114">─</text>
<text x="544" y="114">─</text>
<text x="554" y="114">─</text>
<text x="564" y="114">─</text>
<text x="574" y="114">─</text>
<text x="584" y="114">─</text>
<text x="594" y="114">─</text>
<text x="604" y="114">─</text>
<text x="614" y="114">─</text>
<text x="624" y="114">─</text>
<text x="634" y="114">─</text>
<text x="644" y="114">─</text>
<text x="654" y="114">─</text>
<text x="664" y="114">─</text>
<text x="674" y="114">─</text>
<text x="684" y="114">─</text>
<text x="694" y="114">─</text>
<text x="704" y="114">┘</text>
<text x="324" y="134">│</text>
<text x="344" y="134">n</text>
<text x="354" y="134">e</text>
<text x="364" y="134">w</text>
<text x="384" y="134">T</text>
<text x="394" y="134">h</text>
<text x="404" y="134">r</text>
<text x="414" y="134">e</text>
<text x="424" y="134">a</text>
<text x="434" y="134">d</text>
<text x="444" y="134">(</text>
<text x="454" y="134">)</text>
<text x="474" y="134">時</text>
<text x="494" y="134">，</text>
<text x="514" y="134">J</text>
<text x="524" y="134">V</text>
<text x="534" y="134">M</text>
<text x="554" y="134">自</text>
<text x="574" y="134">動</text>
<text x="594" y="134">複</text>
<text x="614" y="134">製</text>
<text x="634" y="134">快</text>
<text x="654" y="134">照</text>
<text x="324" y="154">▼</text>
<text x="34" y="174">┌</text>
<text x="44" y="174">─</text>
<text x="54" y="174">─</text>
<text x="64" y="174">─</text>
<text x="74" y="174">─</text>
<text x="84" y="174">─</text>
<text x="94" y="174">─</text>
<text x="104" y="174">─</text>
<text x="114" y="174">─</text>
<text x="124" y="174">─</text>
<text x="134" y="174">─</text>
<text x="144" y="174">─</text>
<text x="154" y="174">─</text>
<text x="164" y="174">─</text>
<text x="174" y="174">─</text>
<text x="184" y="174">─</text>
<text x="194" y="174">─</text>
<text x="204" y="174">─</text>
<text x="214" y="174">─</text>
<text x="224" y="174">─</text>
<text x="234" y="174">─</text>
<text x="244" y="174">─</text>
<text x="254" y="174">─</text>
<text x="264" y="174">─</text>
<text x="274" y="174">─</text>
<text x="284" y="174">─</text>
<text x="294" y="174">─</text>
<text x="304" y="174">─</text>
<text x="314" y="174">─</text>
<text x="324" y="174">─</text>
<text x="334" y="174">─</text>
<text x="344" y="174">─</text>
<text x="354" y="174">─</text>
<text x="364" y="174">─</text>
<text x="374" y="174">─</text>
<text x="384" y="174">─</text>
<text x="394" y="174">─</text>
<text x="404" y="174">─</text>
<text x="414" y="174">─</text>
<text x="424" y="174">─</text>
<text x="434" y="174">─</text>
<text x="444" y="174">─</text>
<text x="454" y="174">─</text>
<text x="464" y="174">─</text>
<text x="474" y="174">─</text>
<text x="484" y="174">─</text>
<text x="494" y="174">─</text>
<text x="504" y="174">─</text>
<text x="514" y="174">─</text>
<text x="524" y="174">─</text>
<text x="534" y="174">─</text>
<text x="544" y="174">─</text>
<text x="554" y="174">─</text>
<text x="564" y="174">─</text>
<text x="574" y="174">─</text>
<text x="584" y="174">─</text>
<text x="594" y="174">─</text>
<text x="604" y="174">─</text>
<text x="614" y="174">─</text>
<text x="624" y="174">─</text>
<text x="634" y="174">─</text>
<text x="644" y="174">─</text>
<text x="654" y="174">─</text>
<text x="664" y="174">─</text>
<text x="674" y="174">─</text>
<text x="684" y="174">─</text>
<text x="694" y="174">─</text>
<text x="704" y="174">┐</text>
<text x="34" y="194">│</text>
<text x="64" y="194">子</text>
<text x="84" y="194">執</text>
<text x="104" y="194">行</text>
<text x="124" y="194">緒</text>
<text x="144" y="194">（</text>
<text x="164" y="194">建</text>
<text x="184" y="194">立</text>
<text x="204" y="194">時</text>
<text x="224" y="194">複</text>
<text x="244" y="194">製</text>
<text x="264" y="194">）</text>
<text x="704" y="194">│</text>
<text x="34" y="214">│</text>
<text x="64" y="214">i</text>
<text x="74" y="214">n</text>
<text x="84" y="214">h</text>
<text x="94" y="214">e</text>
<text x="104" y="214">r</text>
<text x="114" y="214">i</text>
<text x="124" y="214">t</text>
<text x="134" y="214">a</text>
<text x="144" y="214">b</text>
<text x="154" y="214">l</text>
<text x="164" y="214">e</text>
<text x="174" y="214">T</text>
<text x="184" y="214">h</text>
<text x="194" y="214">r</text>
<text x="204" y="214">e</text>
<text x="214" y="214">a</text>
<text x="224" y="214">d</text>
<text x="234" y="214">L</text>
<text x="244" y="214">o</text>
<text x="254" y="214">c</text>
<text x="264" y="214">a</text>
<text x="274" y="214">l</text>
<text x="284" y="214">s</text>
<text x="294" y="214">:</text>
<text x="314" y="214">{</text>
<text x="334" y="214">I</text>
<text x="344" y="214">T</text>
<text x="354" y="214">L</text>
<text x="364" y="214">_</text>
<text x="374" y="214">u</text>
<text x="384" y="214">s</text>
<text x="394" y="214">e</text>
<text x="404" y="214">r</text>
<text x="424" y="214">→</text>
<text x="444" y="214">4</text>
<text x="454" y="214">2</text>
<text x="464" y="214">,</text>
<text x="484" y="214">I</text>
<text x="494" y="214">T</text>
<text x="504" y="214">L</text>
<text x="514" y="214">_</text>
<text x="524" y="214">l</text>
<text x="534" y="214">o</text>
<text x="544" y="214">c</text>
<text x="554" y="214">a</text>
<text x="564" y="214">l</text>
<text x="574" y="214">e</text>
<text x="594" y="214">→</text>
<text x="614" y="214">&quot;</text>
<text x="624" y="214">z</text>
<text x="634" y="214">h</text>
<text x="644" y="214">&quot;</text>
<text x="664" y="214">}</text>
<text x="704" y="214">│</text>
<text x="34" y="234">│</text>
<text x="314" y="234">↑</text>
<text x="334" y="234">獨</text>
<text x="354" y="234">立</text>
<text x="374" y="234">副</text>
<text x="394" y="234">本</text>
<text x="414" y="234">，</text>
<text x="434" y="234">修</text>
<text x="454" y="234">改</text>
<text x="474" y="234">互</text>
<text x="494" y="234">不</text>
<text x="514" y="234">影</text>
<text x="534" y="234">響</text>
<text x="704" y="234">│</text>
<text x="34" y="254">└</text>
<text x="44" y="254">─</text>
<text x="54" y="254">─</text>
<text x="64" y="254">─</text>
<text x="74" y="254">─</text>
<text x="84" y="254">─</text>
<text x="94" y="254">─</text>
<text x="104" y="254">─</text>
<text x="114" y="254">─</text>
<text x="124" y="254">─</text>
<text x="134" y="254">─</text>
<text x="144" y="254">─</text>
<text x="154" y="254">─</text>
<text x="164" y="254">─</text>
<text x="174" y="254">─</text>
<text x="184" y="254">─</text>
<text x="194" y="254">─</text>
<text x="204" y="254">─</text>
<text x="214" y="254">─</text>
<text x="224" y="254">─</text>
<text x="234" y="254">─</text>
<text x="244" y="254">─</text>
<text x="254" y="254">─</text>
<text x="264" y="254">─</text>
<text x="274" y="254">─</text>
<text x="284" y="254">─</text>
<text x="294" y="254">─</text>
<text x="304" y="254">─</text>
<text x="314" y="254">─</text>
<text x="324" y="254">─</text>
<text x="334" y="254">─</text>
<text x="344" y="254">─</text>
<text x="354" y="254">─</text>
<text x="364" y="254">─</text>
<text x="374" y="254">─</text>
<text x="384" y="254">─</text>
<text x="394" y="254">─</text>
<text x="404" y="254">─</text>
<text x="414" y="254">─</text>
<text x="424" y="254">─</text>
<text x="434" y="254">─</text>
<text x="444" y="254">─</text>
<text x="454" y="254">─</text>
<text x="464" y="254">─</text>
<text x="474" y="254">─</text>
<text x="484" y="254">─</text>
<text x="494" y="254">─</text>
<text x="504" y="254">─</text>
<text x="514" y="254">─</text>
<text x="524" y="254">─</text>
<text x="534" y="254">─</text>
<text x="544" y="254">─</text>
<text x="554" y="254">─</text>
<text x="564" y="254">─</text>
<text x="574" y="254">─</text>
<text x="584" y="254">─</text>
<text x="594" y="254">─</text>
<text x="604" y="254">─</text>
<text x="614" y="254">─</text>
<text x="624" y="254">─</text>
<text x="634" y="254">─</text>
<text x="644" y="254">─</text>
<text x="654" y="254">─</text>
<text x="664" y="254">─</text>
<text x="674" y="254">─</text>
<text x="684" y="254">─</text>
<text x="694" y="254">─</text>
<text x="704" y="254">┘</text>
<text x="34" y="294">c</text>
<text x="44" y="294">h</text>
<text x="54" y="294">i</text>
<text x="64" y="294">l</text>
<text x="74" y="294">d</text>
<text x="84" y="294">.</text>
<text x="94" y="294">s</text>
<text x="104" y="294">e</text>
<text x="114" y="294">t</text>
<text x="124" y="294">(</text>
<text x="134" y="294">I</text>
<text x="144" y="294">T</text>
<text x="154" y="294">L</text>
<text x="164" y="294">_</text>
<text x="174" y="294">u</text>
<text x="184" y="294">s</text>
<text x="194" y="294">e</text>
<text x="204" y="294">r</text>
<text x="214" y="294">,</text>
<text x="234" y="294">9</text>
<text x="244" y="294">9</text>
<text x="254" y="294">)</text>
<text x="284" y="294">→</text>
<text x="304" y="294">只</text>
<text x="324" y="294">影</text>
<text x="344" y="294">響</text>
<text x="364" y="294">子</text>
<text x="384" y="294">執</text>
<text x="404" y="294">行</text>
<text x="424" y="294">緒</text>
<text x="444" y="294">，</text>
<text x="464" y="294">父</text>
<text x="484" y="294">執</text>
<text x="504" y="294">行</text>
<text x="524" y="294">緒</text>
<text x="544" y="294">仍</text>
<text x="564" y="294">是</text>
<text x="594" y="294">4</text>
<text x="604" y="294">2</text>
<text x="34" y="334">⚠</text>
<text x="64" y="334">執</text>
<text x="84" y="334">行</text>
<text x="104" y="334">緒</text>
<text x="124" y="334">池</text>
<text x="144" y="334">問</text>
<text x="164" y="334">題</text>
<text x="184" y="334">：</text>
<text x="34" y="354">P</text>
<text x="44" y="354">o</text>
<text x="54" y="354">o</text>
<text x="64" y="354">l</text>
<text x="84" y="354">中</text>
<text x="104" y="354">的</text>
<text x="124" y="354">執</text>
<text x="144" y="354">行</text>
<text x="164" y="354">緒</text>
<text x="184" y="354">在</text>
<text x="204" y="354">建</text>
<text x="224" y="354">立</text>
<text x="244" y="354">時</text>
<text x="264" y="354">已</text>
<text x="284" y="354">複</text>
<text x="304" y="354">製</text>
<text x="324" y="354">，</text>
<text x="344" y="354">之</text>
<text x="364" y="354">後</text>
<text x="384" y="354">複</text>
<text x="404" y="354">用</text>
<text x="424" y="354">時</text>
<text x="444" y="354">不</text>
<text x="464" y="354">會</text>
<text x="484" y="354">再</text>
<text x="504" y="354">複</text>
<text x="524" y="354">製</text>
<text x="34" y="374">父</text>
<text x="54" y="374">執</text>
<text x="74" y="374">行</text>
<text x="94" y="374">緒</text>
<text x="114" y="374">後</text>
<text x="134" y="374">續</text>
<text x="154" y="374">修</text>
<text x="174" y="374">改</text>
<text x="194" y="374">的</text>
<text x="214" y="374">值</text>
<text x="234" y="374">，</text>
<text x="254" y="374">P</text>
<text x="264" y="374">o</text>
<text x="274" y="374">o</text>
<text x="284" y="374">l</text>
<text x="304" y="374">W</text>
<text x="314" y="374">o</text>
<text x="324" y="374">r</text>
<text x="334" y="374">k</text>
<text x="344" y="374">e</text>
<text x="354" y="374">r</text>
<text x="374" y="374">看</text>
<text x="394" y="374">不</text>
<text x="414" y="374">到</text>
<text x="34" y="414">─</text>
<text x="44" y="414">─</text>
<text x="54" y="414">─</text>
<text x="64" y="414">─</text>
<text x="74" y="414">─</text>
<text x="84" y="414">─</text>
<text x="94" y="414">─</text>
<text x="104" y="414">─</text>
<text x="114" y="414">─</text>
<text x="124" y="414">─</text>
<text x="134" y="414">─</text>
<text x="144" y="414">─</text>
<text x="154" y="414">─</text>
<text x="164" y="414">─</text>
<text x="174" y="414">─</text>
<text x="184" y="414">─</text>
<text x="194" y="414">─</text>
<text x="204" y="414">─</text>
<text x="214" y="414">─</text>
<text x="224" y="414">─</text>
<text x="234" y="414">─</text>
<text x="244" y="414">─</text>
<text x="254" y="414">─</text>
<text x="264" y="414">─</text>
<text x="274" y="414">─</text>
<text x="284" y="414">─</text>
<text x="294" y="414">─</text>
<text x="304" y="414">─</text>
<text x="314" y="414">─</text>
<text x="324" y="414">─</text>
<text x="334" y="414">─</text>
<text x="344" y="414">─</text>
<text x="354" y="414">─</text>
<text x="364" y="414">─</text>
<text x="374" y="414">─</text>
<text x="384" y="414">─</text>
<text x="394" y="414">─</text>
<text x="404" y="414">─</text>
<text x="414" y="414">─</text>
<text x="424" y="414">─</text>
<text x="434" y="414">─</text>
<text x="444" y="414">─</text>
<text x="454" y="414">─</text>
<text x="464" y="414">─</text>
<text x="474" y="414">─</text>
<text x="484" y="414">─</text>
<text x="494" y="414">─</text>
<text x="504" y="414">─</text>
<text x="514" y="414">─</text>
<text x="524" y="414">─</text>
<text x="534" y="414">─</text>
<text x="544" y="414">─</text>
<text x="554" y="414">─</text>
<text x="564" y="414">─</text>
<text x="574" y="414">─</text>
<text x="584" y="414">─</text>
<text x="594" y="414">─</text>
<text x="604" y="414">─</text>
<text x="614" y="414">─</text>
<text x="624" y="414">─</text>
<text x="634" y="414">─</text>
<text x="644" y="414">─</text>
<text x="654" y="414">─</text>
<text x="664" y="414">─</text>
<text x="674" y="414">─</text>
<text x="34" y="454">設</text>
<text x="54" y="454">計</text>
<text x="74" y="454">哲</text>
<text x="94" y="454">學</text>
<text x="114" y="454">對</text>
<text x="134" y="454">比</text>
<text x="154" y="454">：</text>
<text x="174" y="454">J</text>
<text x="184" y="454">a</text>
<text x="194" y="454">v</text>
<text x="204" y="454">a</text>
<text x="224" y="454">v</text>
<text x="234" y="454">s</text>
<text x="254" y="454">G</text>
<text x="264" y="454">o</text>
<text x="34" y="494">J</text>
<text x="44" y="494">a</text>
<text x="54" y="494">v</text>
<text x="64" y="494">a</text>
<text x="74" y="494">：</text>
<text x="94" y="494">隱</text>
<text x="114" y="494">式</text>
<text x="134" y="494">攜</text>
<text x="154" y="494">帶</text>
<text x="174" y="494">（</text>
<text x="194" y="494">I</text>
<text x="204" y="494">n</text>
<text x="214" y="494">h</text>
<text x="224" y="494">e</text>
<text x="234" y="494">r</text>
<text x="244" y="494">i</text>
<text x="254" y="494">t</text>
<text x="264" y="494">a</text>
<text x="274" y="494">b</text>
<text x="284" y="494">l</text>
<text x="294" y="494">e</text>
<text x="304" y="494">T</text>
<text x="314" y="494">h</text>
<text x="324" y="494">r</text>
<text x="334" y="494">e</text>
<text x="344" y="494">a</text>
<text x="354" y="494">d</text>
<text x="364" y="494">L</text>
<text x="374" y="494">o</text>
<text x="384" y="494">c</text>
<text x="394" y="494">a</text>
<text x="404" y="494">l</text>
<text x="414" y="494">）</text>
<text x="34" y="514">┌</text>
<text x="44" y="514">─</text>
<text x="54" y="514">─</text>
<text x="64" y="514">─</text>
<text x="74" y="514">─</text>
<text x="84" y="514">─</text>
<text x="94" y="514">─</text>
<text x="104" y="514">─</text>
<text x="114" y="514">─</text>
<text x="124" y="514">─</text>
<text x="134" y="514">─</text>
<text x="144" y="514">─</text>
<text x="154" y="514">─</text>
<text x="164" y="514">─</text>
<text x="174" y="514">─</text>
<text x="184" y="514">─</text>
<text x="194" y="514">─</text>
<text x="204" y="514">─</text>
<text x="214" y="514">─</text>
<text x="224" y="514">─</text>
<text x="234" y="514">─</text>
<text x="244" y="514">─</text>
<text x="254" y="514">─</text>
<text x="264" y="514">─</text>
<text x="274" y="514">─</text>
<text x="284" y="514">─</text>
<text x="294" y="514">─</text>
<text x="304" y="514">─</text>
<text x="314" y="514">─</text>
<text x="324" y="514">─</text>
<text x="334" y="514">─</text>
<text x="344" y="514">─</text>
<text x="354" y="514">─</text>
<text x="364" y="514">─</text>
<text x="374" y="514">─</text>
<text x="384" y="514">─</text>
<text x="394" y="514">─</text>
<text x="404" y="514">─</text>
<text x="414" y="514">─</text>
<text x="424" y="514">─</text>
<text x="434" y="514">─</text>
<text x="444" y="514">─</text>
<text x="454" y="514">─</text>
<text x="464" y="514">─</text>
<text x="474" y="514">─</text>
<text x="484" y="514">─</text>
<text x="494" y="514">─</text>
<text x="504" y="514">─</text>
<text x="514" y="514">─</text>
<text x="524" y="514">─</text>
<text x="534" y="514">─</text>
<text x="544" y="514">─</text>
<text x="554" y="514">─</text>
<text x="564" y="514">─</text>
<text x="574" y="514">─</text>
<text x="584" y="514">─</text>
<text x="594" y="514">─</text>
<text x="604" y="514">─</text>
<text x="614" y="514">─</text>
<text x="624" y="514">─</text>
<text x="634" y="514">─</text>
<text x="644" y="514">─</text>
<text x="654" y="514">─</text>
<text x="664" y="514">─</text>
<text x="674" y="514">─</text>
<text x="684" y="514">─</text>
<text x="694" y="514">─</text>
<text x="704" y="514">┐</text>
<text x="34" y="534">│</text>
<text x="54" y="534">上</text>
<text x="74" y="534">下</text>
<text x="94" y="534">文</text>
<text x="114" y="534">隱</text>
<text x="134" y="534">藏</text>
<text x="154" y="534">在</text>
<text x="174" y="534">執</text>
<text x="194" y="534">行</text>
<text x="214" y="534">緒</text>
<text x="234" y="534">內</text>
<text x="254" y="534">部</text>
<text x="704" y="534">│</text>
<text x="34" y="554">│</text>
<text x="54" y="554">優</text>
<text x="74" y="554">點</text>
<text x="94" y="554">：</text>
<text x="114" y="554">呼</text>
<text x="134" y="554">叫</text>
<text x="154" y="554">方</text>
<text x="174" y="554">不</text>
<text x="194" y="554">需</text>
<text x="214" y="554">要</text>
<text x="234" y="554">傳</text>
<text x="254" y="554">參</text>
<text x="704" y="554">│</text>
<text x="34" y="574">│</text>
<text x="54" y="574">缺</text>
<text x="74" y="574">點</text>
<text x="94" y="574">：</text>
<text x="114" y="574">隱</text>
<text x="134" y="574">式</text>
<text x="154" y="574">依</text>
<text x="174" y="574">賴</text>
<text x="194" y="574">，</text>
<text x="214" y="574">難</text>
<text x="234" y="574">以</text>
<text x="254" y="574">追</text>
<text x="274" y="574">蹤</text>
<text x="704" y="574">│</text>
<text x="34" y="594">└</text>
<text x="44" y="594">─</text>
<text x="54" y="594">─</text>
<text x="64" y="594">─</text>
<text x="74" y="594">─</text>
<text x="84" y="594">─</text>
<text x="94" y="594">─</text>
<text x="104" y="594">─</text>
<text x="114" y="594">─</text>
<text x="124" y="594">─</text>
<text x="134" y="594">─</text>
<text x="144" y="594">─</text>
<text x="154" y="594">─</text>
<text x="164" y="594">─</text>
<text x="174" y="594">─</text>
<text x="184" y="594">─</text>
<text x="194" y="594">─</text>
<text x="204" y="594">─</text>
<text x="214" y="594">─</text>
<text x="224" y="594">─</text>
<text x="234" y="594">─</text>
<text x="244" y="594">─</text>
<text x="254" y="594">─</text>
<text x="264" y="594">─</text>
<text x="274" y="594">─</text>
<text x="284" y="594">─</text>
<text x="294" y="594">─</text>
<text x="304" y="594">─</text>
<text x="314" y="594">─</text>
<text x="324" y="594">─</text>
<text x="334" y="594">─</text>
<text x="344" y="594">─</text>
<text x="354" y="594">─</text>
<text x="364" y="594">─</text>
<text x="374" y="594">─</text>
<text x="384" y="594">─</text>
<text x="394" y="594">─</text>
<text x="404" y="594">─</text>
<text x="414" y="594">─</text>
<text x="424" y="594">─</text>
<text x="434" y="594">─</text>
<text x="444" y="594">─</text>
<text x="454" y="594">─</text>
<text x="464" y="594">─</text>
<text x="474" y="594">─</text>
<text x="484" y="594">─</text>
<text x="494" y="594">─</text>
<text x="504" y="594">─</text>
<text x="514" y="594">─</text>
<text x="524" y="594">─</text>
<text x="534" y="594">─</text>
<text x="544" y="594">─</text>
<text x="554" y="594">─</text>
<text x="564" y="594">─</text>
<text x="574" y="594">─</text>
<text x="584" y="594">─</text>
<text x="594" y="594">─</text>
<text x="604" y="594">─</text>
<text x="614" y="594">─</text>
<text x="624" y="594">─</text>
<text x="634" y="594">─</text>
<text x="644" y="594">─</text>
<text x="654" y="594">─</text>
<text x="664" y="594">─</text>
<text x="674" y="594">─</text>
<text x="684" y="594">─</text>
<text x="694" y="594">─</text>
<text x="704" y="594">┘</text>
<text x="34" y="634">G</text>
<text x="44" y="634">o</text>
<text x="54" y="634">：</text>
<text x="74" y="634">顯</text>
<text x="94" y="634">式</text>
<text x="114" y="634">傳</text>
<text x="134" y="634">遞</text>
<text x="154" y="634">（</text>
<text x="174" y="634">c</text>
<text x="184" y="634">o</text>
<text x="194" y="634">n</text>
<text x="204" y="634">t</text>
<text x="214" y="634">e</text>
<text x="224" y="634">x</text>
<text x="234" y="634">t</text>
<text x="244" y="634">.</text>
<text x="254" y="634">C</text>
<text x="264" y="634">o</text>
<text x="274" y="634">n</text>
<text x="284" y="634">t</text>
<text x="294" y="634">e</text>
<text x="304" y="634">x</text>
<text x="314" y="634">t</text>
<text x="324" y="634">）</text>
<text x="34" y="654">┌</text>
<text x="44" y="654">─</text>
<text x="54" y="654">─</text>
<text x="64" y="654">─</text>
<text x="74" y="654">─</text>
<text x="84" y="654">─</text>
<text x="94" y="654">─</text>
<text x="104" y="654">─</text>
<text x="114" y="654">─</text>
<text x="124" y="654">─</text>
<text x="134" y="654">─</text>
<text x="144" y="654">─</text>
<text x="154" y="654">─</text>
<text x="164" y="654">─</text>
<text x="174" y="654">─</text>
<text x="184" y="654">─</text>
<text x="194" y="654">─</text>
<text x="204" y="654">─</text>
<text x="214" y="654">─</text>
<text x="224" y="654">─</text>
<text x="234" y="654">─</text>
<text x="244" y="654">─</text>
<text x="254" y="654">─</text>
<text x="264" y="654">─</text>
<text x="274" y="654">─</text>
<text x="284" y="654">─</text>
<text x="294" y="654">─</text>
<text x="304" y="654">─</text>
<text x="314" y="654">─</text>
<text x="324" y="654">─</text>
<text x="334" y="654">─</text>
<text x="344" y="654">─</text>
<text x="354" y="654">─</text>
<text x="364" y="654">─</text>
<text x="374" y="654">─</text>
<text x="384" y="654">─</text>
<text x="394" y="654">─</text>
<text x="404" y="654">─</text>
<text x="414" y="654">─</text>
<text x="424" y="654">─</text>
<text x="434" y="654">─</text>
<text x="444" y="654">─</text>
<text x="454" y="654">─</text>
<text x="464" y="654">─</text>
<text x="474" y="654">─</text>
<text x="484" y="654">─</text>
<text x="494" y="654">─</text>
<text x="504" y="654">─</text>
<text x="514" y="654">─</text>
<text x="524" y="654">─</text>
<text x="534" y="654">─</text>
<text x="544" y="654">─</text>
<text x="554" y="654">─</text>
<text x="564" y="654">─</text>
<text x="574" y="654">─</text>
<text x="584" y="654">─</text>
<text x="594" y="654">─</text>
<text x="604" y="654">─</text>
<text x="614" y="654">─</text>
<text x="624" y="654">─</text>
<text x="634" y="654">─</text>
<text x="644" y="654">─</text>
<text x="654" y="654">─</text>
<text x="664" y="654">─</text>
<text x="674" y="654">─</text>
<text x="684" y="654">─</text>
<text x="694" y="654">─</text>
<text x="704" y="654">┐</text>
<text x="34" y="674">│</text>
<text x="54" y="674">f</text>
<text x="64" y="674">u</text>
<text x="74" y="674">n</text>
<text x="84" y="674">c</text>
<text x="104" y="674">p</text>
<text x="114" y="674">r</text>
<text x="124" y="674">o</text>
<text x="134" y="674">c</text>
<text x="144" y="674">e</text>
<text x="154" y="674">s</text>
<text x="164" y="674">s</text>
<text x="174" y="674">(</text>
<text x="184" y="674">c</text>
<text x="194" y="674">t</text>
<text x="204" y="674">x</text>
<text x="224" y="674">c</text>
<text x="234" y="674">o</text>
<text x="244" y="674">n</text>
<text x="254" y="674">t</text>
<text x="264" y="674">e</text>
<text x="274" y="674">x</text>
<text x="284" y="674">t</text>
<text x="294" y="674">.</text>
<text x="304" y="674">C</text>
<text x="314" y="674">o</text>
<text x="324" y="674">n</text>
<text x="334" y="674">t</text>
<text x="344" y="674">e</text>
<text x="354" y="674">x</text>
<text x="364" y="674">t</text>
<text x="374" y="674">)</text>
<text x="394" y="674">{</text>
<text x="704" y="674">│</text>
<text x="34" y="694">│</text>
<text x="94" y="694">u</text>
<text x="104" y="694">s</text>
<text x="114" y="694">e</text>
<text x="124" y="694">r</text>
<text x="134" y="694">I</text>
<text x="144" y="694">D</text>
<text x="164" y="694">:</text>
<text x="174" y="694">=</text>
<text x="194" y="694">c</text>
<text x="204" y="694">t</text>
<text x="214" y="694">x</text>
<text x="224" y="694">.</text>
<text x="234" y="694">V</text>
<text x="244" y="694">a</text>
<text x="254" y="694">l</text>
<text x="264" y="694">u</text>
<text x="274" y="694">e</text>
<text x="284" y="694">(</text>
<text x="294" y="694">&quot;</text>
<text x="304" y="694">u</text>
<text x="314" y="694">s</text>
<text x="324" y="694">e</text>
<text x="334" y="694">r</text>
<text x="344" y="694">_</text>
<text x="354" y="694">i</text>
<text x="364" y="694">d</text>
<text x="374" y="694">&quot;</text>
<text x="384" y="694">)</text>
<text x="704" y="694">│</text>
<text x="34" y="714">│</text>
<text x="94" y="714">c</text>
<text x="104" y="714">h</text>
<text x="114" y="714">i</text>
<text x="124" y="714">l</text>
<text x="134" y="714">d</text>
<text x="144" y="714">(</text>
<text x="154" y="714">c</text>
<text x="164" y="714">t</text>
<text x="174" y="714">x</text>
<text x="184" y="714">)</text>
<text x="214" y="714">←</text>
<text x="234" y="714">顯</text>
<text x="254" y="714">式</text>
<text x="274" y="714">傳</text>
<text x="294" y="714">遞</text>
<text x="704" y="714">│</text>
<text x="34" y="734">│</text>
<text x="54" y="734">}</text>
<text x="704" y="734">│</text>
<text x="34" y="754">│</text>
<text x="54" y="754">優</text>
<text x="74" y="754">點</text>
<text x="94" y="754">：</text>
<text x="114" y="754">資</text>
<text x="134" y="754">料</text>
<text x="154" y="754">流</text>
<text x="174" y="754">向</text>
<text x="194" y="754">清</text>
<text x="214" y="754">晰</text>
<text x="234" y="754">，</text>
<text x="254" y="754">易</text>
<text x="274" y="754">於</text>
<text x="294" y="754">測</text>
<text x="314" y="754">試</text>
<text x="704" y="754">│</text>
<text x="34" y="774">│</text>
<text x="54" y="774">缺</text>
<text x="74" y="774">點</text>
<text x="94" y="774">：</text>
<text x="114" y="774">所</text>
<text x="134" y="774">有</text>
<text x="154" y="774">函</text>
<text x="174" y="774">式</text>
<text x="194" y="774">都</text>
<text x="214" y="774">需</text>
<text x="234" y="774">要</text>
<text x="254" y="774">加</text>
<text x="284" y="774">c</text>
<text x="294" y="774">t</text>
<text x="304" y="774">x</text>
<text x="324" y="774">參</text>
<text x="344" y="774">數</text>
<text x="704" y="774">│</text>
<text x="34" y="794">└</text>
<text x="44" y="794">─</text>
<text x="54" y="794">─</text>
<text x="64" y="794">─</text>
<text x="74" y="794">─</text>
<text x="84" y="794">─</text>
<text x="94" y="794">─</text>
<text x="104" y="794">─</text>
<text x="114" y="794">─</text>
<text x="124" y="794">─</text>
<text x="134" y="794">─</text>
<text x="144" y="794">─</text>
<text x="154" y="794">─</text>
<text x="164" y="794">─</text>
<text x="174" y="794">─</text>
<text x="184" y="794">─</text>
<text x="194" y="794">─</text>
<text x="204" y="794">─</text>
<text x="214" y="794">─</text>
<text x="224" y="794">─</text>
<text x="234" y="794">─</text>
<text x="244" y="794">─</text>
<text x="254" y="794">─</text>
<text x="264" y="794">─</text>
<text x="274" y="794">─</text>
<text x="284" y="794">─</text>
<text x="294" y="794">─</text>
<text x="304" y="794">─</text>
<text x="314" y="794">─</text>
<text x="324" y="794">─</text>
<text x="334" y="794">─</text>
<text x="344" y="794">─</text>
<text x="354" y="794">─</text>
<text x="364" y="794">─</text>
<text x="374" y="794">─</text>
<text x="384" y="794">─</text>
<text x="394" y="794">─</text>
<text x="404" y="794">─</text>
<text x="414" y="794">─</text>
<text x="424" y="794">─</text>
<text x="434" y="794">─</text>
<text x="444" y="794">─</text>
<text x="454" y="794">─</text>
<text x="464" y="794">─</text>
<text x="474" y="794">─</text>
<text x="484" y="794">─</text>
<text x="494" y="794">─</text>
<text x="504" y="794">─</text>
<text x="514" y="794">─</text>
<text x="524" y="794">─</text>
<text x="534" y="794">─</text>
<text x="544" y="794">─</text>
<text x="554" y="794">─</text>
<text x="564" y="794">─</text>
<text x="574" y="794">─</text>
<text x="584" y="794">─</text>
<text x="594" y="794">─</text>
<text x="604" y="794">─</text>
<text x="614" y="794">─</text>
<text x="624" y="794">─</text>
<text x="634" y="794">─</text>
<text x="644" y="794">─</text>
<text x="654" y="794">─</text>
<text x="664" y="794">─</text>
<text x="674" y="794">─</text>
<text x="684" y="794">─</text>
<text x="694" y="794">─</text>
<text x="704" y="794">┘</text>
</g>
</svg>
</div>
<p>InheritableThreadLocal 可在建立子執行緒時複製上下文。</p>
<p>跨語言對比：</p>
<ul>
<li>C/C++: <code>thread_local</code> — 關鍵字宣告，編譯器自動為每個執行緒分配獨立儲存</li>
<li>Rust: <code>thread_local!</code> — 宏定義，支援懶初始化</li>
<li>Go: 常用 <code>context.Context</code> 顯式傳遞，不鼓勵隱式 thread local；這反映了 Go 「明確優於隱式」的設計哲學</li>
</ul>
<pre><code class="language-text">Thread A: user_id=42
Thread B: user_id=? (預設拿不到 A 的值)
</code></pre>
<h2 id="跨語言完整範例"><a class="header" href="#跨語言完整範例">跨語言完整範例</a></h2>
<p>執行緒本地儲存：每個執行緒有自己的 user_id，互不干擾，演示隔離性。</p>
<h3 id="c"><a class="header" href="#c">C</a></h3>
<pre><code class="language-c">/* 編譯: gcc -O2 -pthread -o ch14_c ch14.c &amp;&amp; ./ch14_c */
#include &lt;stdio.h&gt;
#include &lt;pthread.h&gt;
#include &lt;unistd.h&gt;

/* thread_local 在 C11 中為 _Thread_local，gcc 支援 __thread */
static __thread int user_id = 0;

typedef struct { int set_id; const char *name; } Args;

void *thread_fn(void *arg) {
    Args *a = (Args *)arg;
    user_id = a-&gt;set_id;                  /* 只影響當前執行緒 */
    usleep(10000);                         /* 讓其他執行緒也設定自己的值 */
    printf("%-10s user_id=%d\n", a-&gt;name, user_id);
    return NULL;
}

int main(void) {
    Args args[] = {{42, "Thread-A"}, {7, "Thread-B"}, {100, "Thread-C"}};
    pthread_t threads[3];

    for (int i = 0; i &lt; 3; i++)
        pthread_create(&amp;threads[i], NULL, thread_fn, &amp;args[i]);
    for (int i = 0; i &lt; 3; i++)
        pthread_join(threads[i], NULL);

    printf("Main thread user_id=%d (never set, remains 0)\n", user_id);
    return 0;
}
</code></pre>
<h3 id="c-1"><a class="header" href="#c-1">C++</a></h3>
<pre><code class="language-cpp">// 編譯: g++ -std=c++17 -O2 -pthread -o ch14_cpp ch14.cpp &amp;&amp; ./ch14_cpp
#include &lt;iostream&gt;
#include &lt;thread&gt;
#include &lt;vector&gt;
#include &lt;chrono&gt;

thread_local int user_id = 0;          // 每個執行緒各自的 user_id
thread_local std::string request_id;   // 每個執行緒各自的 request_id

void handle_request(int uid, const std::string &amp;rid) {
    user_id    = uid;
    request_id = rid;
    std::this_thread::sleep_for(std::chrono::milliseconds(10));

    // 讀回自己的值，不受其他執行緒影響
    std::cout &lt;&lt; "Thread " &lt;&lt; std::this_thread::get_id()
              &lt;&lt; " user_id=" &lt;&lt; user_id
              &lt;&lt; " request_id=" &lt;&lt; request_id &lt;&lt; "\n";
}

int main() {
    std::vector&lt;std::thread&gt; threads;
    threads.emplace_back(handle_request, 42,  "req-001");
    threads.emplace_back(handle_request, 7,   "req-002");
    threads.emplace_back(handle_request, 100, "req-003");
    for (auto &amp;t : threads) t.join();
    std::cout &lt;&lt; "main thread: user_id=" &lt;&lt; user_id
              &lt;&lt; " (0，從未設定)\n";
    return 0;
}
</code></pre>
<h3 id="rust"><a class="header" href="#rust">Rust</a></h3>
<pre><pre class="playground"><code class="language-rust">// 執行: cargo run 或 rustc ch14.rs -o ch14 &amp;&amp; ./ch14
use std::cell::RefCell;
use std::thread;

thread_local! {
    static USER_ID:    RefCell&lt;i32&gt;     = RefCell::new(0);
    static REQUEST_ID: RefCell&lt;String&gt;  = RefCell::new(String::new());
}

fn handle_request(uid: i32, rid: &amp;'static str) {
    USER_ID.with(|u| *u.borrow_mut() = uid);
    REQUEST_ID.with(|r| *r.borrow_mut() = rid.to_string());

    thread::sleep(std::time::Duration::from_millis(10));

    USER_ID.with(|u| {
        REQUEST_ID.with(|r| {
            println!("thread {:?}: user_id={}, request_id={}",
                     thread::current().id(), u.borrow(), r.borrow());
        });
    });
}

fn main() {
    let handles: Vec&lt;_&gt; = vec![
        (42,  "req-001"),
        (7,   "req-002"),
        (100, "req-003"),
    ].into_iter().map(|(uid, rid)| {
        thread::spawn(move || handle_request(uid, rid))
    }).collect();

    for h in handles { h.join().unwrap(); }
    USER_ID.with(|u| println!("main: user_id={} (0，從未設定)", u.borrow()));
}</code></pre></pre>
<h3 id="go"><a class="header" href="#go">Go</a></h3>
<pre><code class="language-go">// 執行: go run ch14.go
// Go 不推薦隱式 thread-local，改用 context.Context 顯式傳遞
package main

import (
	"context"
	"fmt"
	"sync"
	"time"
)

type contextKey string

const keyUserID    contextKey = "user_id"
const keyRequestID contextKey = "request_id"

// handleRequest 接收 context，從中讀取執行緒「本地」資料
// 這是 Go 的慣用做法：顯式傳遞，不依賴隱式 goroutine-local
func handleRequest(ctx context.Context, wg *sync.WaitGroup) {
	defer wg.Done()
	time.Sleep(10 * time.Millisecond)

	uid := ctx.Value(keyUserID)
	rid := ctx.Value(keyRequestID)
	fmt.Printf("goroutine: user_id=%v, request_id=%v\n", uid, rid)
}

func main() {
	var wg sync.WaitGroup
	requests := []struct {
		userID    int
		requestID string
	}{
		{42, "req-001"},
		{7, "req-002"},
		{100, "req-003"},
	}

	for _, req := range requests {
		ctx := context.WithValue(context.Background(), keyUserID, req.userID)
		ctx = context.WithValue(ctx, keyRequestID, req.requestID)
		wg.Add(1)
		go handleRequest(ctx, &amp;wg)
	}
	wg.Wait()
	fmt.Println("Done — Go 使用 context 顯式傳遞，語意清晰")
}
</code></pre>
<h3 id="python"><a class="header" href="#python">Python</a></h3>
<pre><code class="language-python"># 執行: python3 ch14.py
import threading
import time


# threading.local() 為每個執行緒提供獨立的命名空間
local_storage = threading.local()


def handle_request(user_id: int, request_id: str):
    """每個執行緒設定自己的 local 變數，互不干擾。"""
    local_storage.user_id    = user_id
    local_storage.request_id = request_id
    time.sleep(0.01)   # 讓其他執行緒也在設定自己的值

    # 讀回自己設定的值
    print(f"{threading.current_thread().name}: "
          f"user_id={local_storage.user_id}, "
          f"request_id={local_storage.request_id}")


if __name__ == "__main__":
    requests = [(42, "req-001"), (7, "req-002"), (100, "req-003")]
    threads = [
        threading.Thread(target=handle_request, args=(uid, rid),
                         name=f"Thread-{i}")
        for i, (uid, rid) in enumerate(requests)
    ]
    for t in threads: t.start()
    for t in threads: t.join()

    # 主執行緒從未設定，讀取會拋出 AttributeError
    try:
        print(f"main: user_id={local_storage.user_id}")
    except AttributeError:
        print("main: user_id 未設定（符合預期，各執行緒隔離）")
</code></pre>
<h2 id="完整專案級範例python"><a class="header" href="#完整專案級範例python">完整專案級範例（Python）</a></h2>
<p>檔案：<code>examples/python/ch14.py</code></p>
<pre><code class="language-bash">python3 examples/python/ch14.py
</code></pre>
<pre><code class="language-python">"""Chapter 14: thread local — 執行緒本地儲存，每個執行緒持有獨立副本。"""
import threading

local = threading.local()


def run(name: str, uid: int):
    """設定執行緒本地的 user_id，讀回時只看到自己設定的值。"""
    local.user_id = uid
    # 即使其他執行緒同時修改各自的 user_id，這裡讀到的仍是自己的值
    print(f"{name} user_id={local.user_id}")


if __name__ == "__main__":
    t1 = threading.Thread(target=run, args=("T1", 42))
    t2 = threading.Thread(target=run, args=("T2", 7))
    t1.start(); t2.start(); t1.join(); t2.join()
    # 主執行緒從未設定，驗證隔離性
    try:
        print(f"main user_id={local.user_id}")
    except AttributeError:
        print("main: user_id 不存在（各執行緒完全隔離）")
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="ch13-threadpool.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="ch15-threadpool-practice.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="ch13-threadpool.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="ch15-threadpool-practice.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
